"use strict";define("TFS/Views/SuiteMePage",["require","exports","react","VSSUI/Pill","VSSUI/PillGroup","VSS/Platform/Layout","VSSUI/Link","VSS/Core/Util/String","VSS/Platform/Location","VSSUI/FocusZone","VSSUI/Image","VSSUI/TooltipEx","VSSUI/Util","VSS/Core/Observable","VSS/Platform/Context","VSSUI/Button","VSSUI/Card","VSSUI/FocusGroup","VSSUI/FocusWithin","VSSUI/TextFilterBarItem","VSSUI/Utilities/Filter","VSSUI/VssPersona","VSSUI/Utilities/ScreenSize","VSS/Features/PlatformUI/ContributedMenu","VSS/Features/PlatformUI/ContributedTab","VSSUI/Header","VSSUI/Observer","VSSUI/Page","VSSUI/Surface","VSSUI/Tabs","VSSUI/ZeroData"],(function(e,t,r,s,a,o,n,i,c,l,u,m,d,p,h,g,P,v,S,f,j,C,w,b,x,I,E,V,N,y,U){var T,F,M;T=t[M="Resources"]={},t[M].SuiteMeGreeting="Welcome back, {0}",t[M].SuiteMeSecondaryGreeting="Plan, Code, Build, Test, repeat in that order (or in any order). Choose where to start.",t[M].MyAccounts="My organizations",t[M].Collections="Collections",t[M].RelatedPages="Related pages",t[M].WhatsNew="What's new",t[M].WhatsNewInDevOps="What's new in DevOps",t[M].ProjectDocumentation="Documentation",t[M].AccessLevels="Access levels",t[M].GetHelp="Get help",t[M].FilterProjects="Filter projects",t[M].FilterTextItemClearLabel="Clear the filter input",t[M].NoSearchResults="No match found.",t[M].ResetSearch="Reset filter",t[M].Projects="Projects",t[M].AdminSettings="Admin settings",t[M].OrgSettings="Organization settings",t[M].CreateProject="Create project",t[M].NewOrg="New organization",t[M].NewProject="New project",t[M].ZeroProjectsHeader="Create a project to get started",t[M].InstalledProductAriaLabel="Navigate to {0} for {1}",t[M].ErrorMessage="Error loading projects. Please try again.",function(e){t[e]={};class i extends o.VssComponent{constructor(e,t){super(e,t),this.announcementClicked=e=>{this.context.pageContext.getService("IVssTelemetryService").publishEvent("ms.vss-tfs-web.announcements","AnnouncementClicked",{href:e})};const r=t.pageContext.getService("IVssContributionService").getData("ms.vss-tfs-web.announcements-data-provider"),s=r&&r.announcements?r.announcements[0]:void 0;this.state={announcement:s}}render(){const{announcement:e}=this.state;return e?r.createElement("div",{className:"global-announcement flex-column flex-grow fontSizeM "},r.createElement(n.Link,{href:e.href,className:"announcement-link",target:"_blank",onClick:t=>this.announcementClicked(e.href),rel:"noopener noreferrer"},r.createElement(a.PillGroup,null,r.createElement(s.Pill,{className:"header-label colored dark",excludeFocusZone:!0,excludeTabStop:!0,size:0},e.pillText||T.WhatsNew)),r.createElement("div",{className:"header body-m"},e.header),r.createElement("div",{className:"body-s"},e.message))):null}}t[e].GlobalAnnouncementComponent=i,i.componentType="globalAnnouncement",o.VssComponent.register(i.componentType,i)}("SuiteMePageViewAnnouncement"),function(e){F=t[e]={};class s extends o.VssComponent{render(){return r.createElement(l.FocusZoneContext.Consumer,null,(e=>r.createElement("div",{className:"flex-row installed-product flex-end"},this.getProductComponents(e))))}getProductComponents(e){const t=[];if(this.props.products&&this.props.products.length){let r=0;this.props.products.sort(((e,t)=>e.order-t.order)),this.props.products.forEach((s=>{r+=30,t.push(this.onRenderProduct(s,r,e))}))}return t}onRenderProduct(e,t,s){const a=e&&e._links&&e._links.icon,o=a&&(0,c.getAssetLocation)(this.context.pageContext,a.href);let n;const l=e.featureProperties&&e.featureProperties.defaultRoute;if(l)try{n=(0,c.routeUrl)(this.context.pageContext,l,{project:this.props.projectName})}catch(e){}let p=r.createElement(r.Fragment,null,r.createElement("div",{className:"placeholder"}),r.createElement("div",{className:(0,d.css)("product-image-container","animation-delay-"+t)},r.createElement("div",{className:"flex-row link-icon"},r.createElement(u.Image,{alt:"",className:"product-image",src:o}))));return p=n?r.createElement("a",{className:"product",href:n,tabIndex:-1,"data-focuszone":s.focuszoneId,"aria-label":(0,i.format)(T.InstalledProductAriaLabel,e.name,this.props.projectName)},p):r.createElement("div",{className:"product"},p),r.createElement(m.Tooltip,{key:e.id},p)}}t[e].InstalledProductsComponent=s}("SuiteMePageViewInstalledProducts"),function(e){t.SuiteMePageViewProjectsPivotService={};class r extends h.VssService{getProjectsPivotView(){if(!this.view){const e=this.pageContext.getService("IVssHistoryService").getState(),t=this.pageContext.getService("IVssContributionService");let r,s;const a=new p.ObservableValue(void 0);let o;const n=!!e.product||!!e.acquisition,i=t.getData("ms.vss-tfs-web.collection-first-run-data-provider");if(i&&i.preCreatedProjectId)r=new p.ObservableArray,s=new p.ReadyableObservableArray,a.value=!1,o=i.preCreatedProjectId;else{const e=this.pageContext.getService("ITfsProjectService");r=e.getMruProjects(),s=e.getAllProjects(),r.length?a.value=!0:s.ready.value?a.value=s.value.length>0:s.ready.subscribe((()=>{a.value=this.view.allProjects.value.length>0}))}this.view={mruProjects:r,allProjects:s,hasProjects:a,preCreatedProjectId:o,useSimpleProjectCreate:n,projectCreateUrlParameters:e}}return this.view}}h.Services.add("IProjectsPivotViewSerivce",{serviceFactory:r})}(),function(e){t.SuiteMePageViewProjectsPivot={};class s extends h.VssService{getTabs(e){const t=new j.Filter,s=new p.ObservableCollection;this.pageContext.getService("IVssSecurityService").hasPermission("3E65F728-F8BC-4ecd-8764-7E378B19BFA7","NAMESPACE",4)&&s.push([{id:"create",className:"create-project-button",text:T.NewProject,iconProps:{iconName:"Add"},onActivate:()=>{document.body.dispatchEvent(new CustomEvent("suiteHomeCreateProject",{}))},isPrimary:!0}]),(0,b.addMenuItems)(this.pageContext,s,"ms.vss-tfs-web.suite-home-projects-pivot-commands");return[{id:"projects",name:T.Projects,order:0,routeId:"ms.vss-tfs-web.suite-me-page-route",commandBarItems:s,render:()=>r.createElement(a,{filter:t}),renderFilterBar:e=>e?r.createElement(f.InlineKeywordFilterBarItem,{filter:t,filterItemKey:"keyword",maxTextLength:50,placeholder:T.FilterProjects}):void 0}]}}h.Services.add("suite-home-projects-pivot-provider-service",{serviceFactory:s});class a extends o.VssComponent{constructor(e,t){super(e,t),this._ttiMarked=!1,this._onCreateProjectClick=()=>{this.setState({showCreateProjectView:!0})},this._onFilterChanged=e=>{const t=e.keyword;t&&this._performSearch(t.value)},this._performSearch=e=>{let t;if(e){const r=e.toLowerCase();t=this.state.allProjects.filter((e=>-1!==e.name.toLowerCase().indexOf(r))),this.setState({searchInProgress:!0,searchResults:t})}else this._onClear()},this._onClear=()=>{this.setState({searchInProgress:!1,searchResults:void 0}),this.props.filter.reset()},this.onResize=e=>{const t=this.getNumberOfCardsToDisplay(this.state.allMruProjects.length);if(this.state.mruProjects.length!==t){const e=this.state.allMruProjects.slice(0,t);this.setState({mruProjects:e})}},this.onCancelCreateProject=()=>{this.setState({showCreateProjectView:!1})};const r=t.pageContext.getService("IProjectsPivotViewSerivce").getProjectsPivotView();r.mruProjects.subscribe((()=>{this.setState({allMruProjects:r.mruProjects.value,mruProjects:r.mruProjects.value.slice(0,this.getNumberOfCardsToDisplay(r.mruProjects.value.length))})})),r.allProjects.subscribe((()=>{this.setState({allProjects:r.allProjects.value})})),this._initialUrlState=r.projectCreateUrlParameters;const s=this._initialUrlState[a.actionParameterKey]||this._initialUrlState[a.actionParameterKeyAlt],o=!!s&&((0,i.equals)(a.newProjectAction,s,!0)||(0,i.equals)("new",s,!0));this.state={searchInProgress:!1,allProjects:r.allProjects.value,mruProjects:r.mruProjects.value.slice(0,this.getNumberOfCardsToDisplay(r.mruProjects.value.length)),allMruProjects:r.mruProjects.value,searchResults:void 0,showCreateProjectView:o}}componentDidMount(){super.componentDidMount(),this.props.filter.subscribe(this._onFilterChanged),this.addEventListener(document.body,"suiteHomeCreateProject",this._onCreateProjectClick),this.addEventListener(window,"resize",this.onResize),this.state.mruProjects&&this.state.mruProjects.length&&this.ensureScenarioRecorded()}componentWillUnmount(){super.componentWillUnmount(),this.props.filter.unsubscribe(this._onFilterChanged)}render(){const{allProjects:e,mruProjects:t,searchInProgress:s,searchResults:a,showCreateProjectView:i}=this.state,c=[],u=this.state.allProjects.length>this.state.mruProjects.length;return t.forEach((e=>{c.push(r.createElement(n,{project:e,key:e.id}))})),r.createElement(r.Fragment,null,i&&r.createElement(o.WrappedComponent,{dependencies:["ms.vss-tfs-web.create-project-panel"],className:"page-content page-content-top",wrappedType:"createProjectPanel",showPanel:!0,invokingSource:this._initialUrlState.source||"SuiteMePage",processTemplate:this._initialUrlState.processTemplate,versionControlType:this._initialUrlState.versionControl,acquisitionId:this._initialUrlState.acquisitionId,defaultFeatureIds:this._initialUrlState.featureId?[this._initialUrlState.featureId]:void 0,projectVisibility:this._initialUrlState.projectVisibility,onPanelDismiss:this.onCancelCreateProject}),r.createElement("div",{className:"page-content flex-column flex-grow flex-noshrink"},r.createElement("div",{className:(0,o.css)("mru-projects",a&&"hidden")},r.createElement(w.ScreenSizeObserver,null,(e=>r.createElement(l.FocusZone,{circularNavigation:!0,direction:1,focusGroupProps:{defaultElementId:t.length>0?t[0].id:void 0}},r.createElement("ul",{className:(0,o.css)("suite-project-list justify-start",e.screenSize>0?"flex-row":"flex-column")},c))))),!s||s&&a&&a.length?r.createElement(P.Card,{className:"no-padding",contentProps:{contentPadding:!1}},r.createElement(o.WrappedComponent,{dependencies:["ms.vss-tfs-web.suite-me-page-project-list-content"],wrappedType:"tfs-suite-project-list",projects:a||(u?e:[])})):r.createElement("div",{className:"flex-column flex-grow flex-center justify-center"},r.createElement("div",{className:"font-size-ll font-weight-semibold"},T.NoSearchResults),r.createElement(g.Button,{className:"reset-search",onClick:this._onClear},T.ResetSearch))))}componentDidUpdate(e,t){super.componentDidUpdate(e,t),this.ensureScenarioRecorded()}ensureScenarioRecorded(){if(!this._ttiMarked){this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive("tfs","WebPlatform.Collection.Home"),this._ttiMarked=!0}}getNumberOfCardsToDisplay(e){const t=window.innerWidth,r=t-108-64-260,s=t>1820?4:3;let a=Math.min(Math.max(2,e),s),o=r/a;for(;o<=300&&a>2;)a--,o=r/a;return t<600&&(a=3),a}}a.newProjectAction="newProject",a.actionParameterKey="_a",a.actionParameterKeyAlt="action";class n extends r.Component{constructor(){super(...arguments),this.onFocus=()=>{this.focusGroupContext&&this.focusGroupContext.onFocus(this.props.project.id)}}render(){const{project:e}=this.props;return r.createElement(S.FocusWithin,{onFocus:this.onFocus},(t=>r.createElement("li",{className:(0,o.css)("project-card flex-row flex-grow",t.hasFocus&&"focused"),onFocus:t.onFocus,onBlur:t.onBlur},r.createElement(P.Card,{className:"flex-grow no-padding",contentProps:{contentPadding:!1}},r.createElement(v.FocusGroupContext.Consumer,null,(t=>(this.focusGroupContext=t,r.createElement(l.FocusZoneContext.Consumer,null,(s=>r.createElement("a",{className:"project-link flex-column flex-grow","data-focuszone":s.focuszoneId,href:e.url,id:e.id,tabIndex:t.focusedElementId===e.id?0:-1},r.createElement("div",{className:"top-row flex-row flex-noshrink flex-grow"},r.createElement(C.VssPersona,{ariaLabel:null,className:"project-persona",identityDetailsProvider:{getDisplayName:()=>e.name,getIdentityImageUrl:()=>e.imageUrl},size:"large"}),r.createElement("div",{className:"flex-column project-details"},r.createElement("div",{className:"project-name font-size-l font-weight-semibold"},e.name),r.createElement("div",{className:"project-description"},e.description))))))))),r.createElement("div",{className:"installed-products-row flex-row flex-grow flex-noshrink justify-end"},r.createElement(w.ScreenSizeConditional,{condition:e=>e>0},r.createElement(F.InstalledProductsComponent,{products:e.products,projectName:e.name})))))))}}}(),function(e){t.SuiteMePageViewSuiteMePageView={};class s extends o.VssComponent{constructor(e,t){let r,s;super(e,t),this.onSelectedTabChanged=e=>{this.state.selectedTab.value=e};const a=t.pageContext.getService("IVssNavigationService").getCurrentRoute().routeValues,o=new p.ObservableValue(a.view||a.contributionId||"projects");"projects"===o.value&&(r=t.pageContext.getService("IProjectsPivotViewSerivce").getProjectsPivotView(),s=r.hasProjects),this.state={hasProjects:s,hostName:t.pageContext.getService("IVssPageService").getData().hostName,projectsView:r,selectedTab:o,tabs:(0,x.getTabs)(t.pageContext,"ms.vss-tfs-web.suite-home-pivots",{defaultRouteId:"ms.vss-tfs-web.suite-me-page-ext-route",fpsRequired:!0,updateUrlOnPivotChange:!0})}}render(){const{hasProjects:e,hostName:t,projectsView:s,selectedTab:a,tabs:n}=this.state,i=this.context.pageContext.getService("IVssContributionService");return i.getDataProviderExceptions()["ms.vss-tfs-web.project-mru-data-provider"]||i.getDataProviderExceptions()["ms.vss-tfs-web.project-plus-product-data-provider"]?r.createElement("div",{className:"suite-me-page-view-zero-data"},r.createElement(U.ZeroData,{primaryText:T.ErrorMessage,imagePath:(0,c.getAssetLocation)(this.context.pageContext,"ms.vss-tfs-web/suite-me-page-content/images/no-results.png"),imageAltText:""})):r.createElement("div",{className:"suite-me-page-view flex flex-grow flex-stretch v-scroll-auto absolute-fill"},r.createElement("div",{className:"suite-me-page-view-container flex flex-column flex-grow v-scroll-auto"},r.createElement(N.Surface,{background:1},r.createElement(V.Page,{className:"flex-grow custom-scrollbar scroll-auto-hide",selectedTabId:a,tabProviders:n},r.createElement(E.Observer,{hasProjects:e},(e=>!1!==e.hasProjects?r.createElement(r.Fragment,null,r.createElement(I.Header,{title:t,titleSize:1,className:"hostname-header flex-noshrink"}),r.createElement(y.TabBar,{className:"suite-me-page-tabbar flex-wrap",onSelectedTabChanged:this.onSelectedTabChanged}),r.createElement(y.TabContent,null)):s?r.createElement("div",{className:"flex flex-grow justify-center"},r.createElement("img",{className:"inline-create-project-image",src:(0,c.getAssetLocation)(this.context.pageContext,"ms.vss-tfs-web/suite-me-page-content/images/zero-data-first-project.png"),alt:T.ZeroProjectsHeader}),r.createElement("div",{className:"flex-column inline-create-project-form"},r.createElement("div",{className:"inline-create-project-header title-l"},T.ZeroProjectsHeader),r.createElement(o.WrappedComponent,{dependencies:["ms.vss-tfs-web.create-project-panel"],wrappedType:"createProjectComponent",className:"flex-grow",invokingSource:s.projectCreateUrlParameters.source||"SuiteMePage",isLightWeightView:s.useSimpleProjectCreate,preCreatedProjectId:s.preCreatedProjectId,processTemplate:s.projectCreateUrlParameters.processTemplate,versionControlType:s.projectCreateUrlParameters.versionControl,acquisitionId:s.projectCreateUrlParameters.acquisitionId,product:s.projectCreateUrlParameters.product,defaultFeatureIds:s.projectCreateUrlParameters.featureId?[s.projectCreateUrlParameters.featureId]:void 0,projectVisibility:s.projectCreateUrlParameters.projectVisibility}))):r.createElement("div",null)))))))}}o.Components.add("suiteMePageView",s)}()}),["Resources","SuiteMePageView/Announcement","SuiteMePageView/InstalledProducts","SuiteMePageView/ProjectsPivotService","SuiteMePageView/ProjectsPivot","SuiteMePageView/SuiteMePageView"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-tfs-web.suite-me-page-content"}}));