"use strict";define("Wit/Search",["require","exports","react","VSS/Core/Observable","VSS/Platform/Context","VSS/Core/Util/Accessibility","VSS/Core/Util/String","VSS/Platform/Location","VSS/Platform/FPS","InstantSearch/Shared/InstantSearchProviders/BaseInstantSearchProvider","InstantSearch/Shared/ResultRow","VSS/Platform/Feature","VSS/Legacy/Legacy","VSSUI/Util","VSSUI/Utilities/FriendlyNumber","VSS/Core/TimerManagement","InstantSearch/Shared/Utils","VSS/Features/Search/SearchHelp","VSSUI/VssIcon","VSS/Platform/Layout","VSS/Features/Identities/IdentityPickerProvider","VSSUI/SuggestionsList","VSSUI/Observer","VSSUI/Components/IdentityPickerSuggestionsList/IdentityPickerSuggestionItem","VSS/Platform/Components/Format","InstantSearch/Shared/SearchSuggestions","InstantSearch/Shared/TelemetryWriter"],(function(e,t,s,r,i,o,n,a,c,u,l,h,d,p,g,m,S,I,y,v,k,x,_,f,T,F,b){var C,P,w,W,R,N,E,M,A,B;C=t[B="Resources"]={},t[B].FilterByField="Filter by field",t[B].FilterByFieldExample='e.g., Tags:"Release Blocker"',t[B].FilterByFieldFooter="Start typing to find out more...",t[B].AssignedToHint="Assigned To",t[B].CreatedByHint="Created By",t[B].StateHint="State",t[B].WITHint="Work Item Type",t[B].Operators="Operators",t[B].OperatorsExample="(e.g., ToDo OR revisit)",t[B].NoSearchSuggestionsInProjectMessage="No {0} results found in {1}.",t[B].NoSearchSuggestionsMessage="No {0} results found.",t[B].WorkItemText="work item",t[B].BoardText="board",t[B].SprintText="sprint",t[B].BacklogText="backlog",t[B].WorkItemsHeader="Work items",t[B].BoardsHeader="Other items in Boards",t[B].RecentWorkItemsHeader="Recent work items",t[B].RecentBoardsHeader="Recent boards",t[B].ViewAllResults="View all {0} work items",t[B].QueryHelpFilterGroupCaption="ADD A SEARCH FILTER",t[B].DayZeroMessage="Enjoy smart suggestions as you type.",t[B].GenericErrorMessage="Oops, something went wrong. Please try again.",t[B].WorkItemIdAriaLabel="ID {0}",t[B].SingleResultLoadedMessage="Result loaded.",t[B].ResultsLoadedMessage="Results loaded.",t[B].RecentWorkItemsLoadedMessage="Recent workitems loaded.",t[B].IdentityPickerLoadingText="Loading Suggestions",t[B].IdentityPickerNoResultsText="No results found",function(e){P=t[e]={};class r extends s.Component{constructor(){super(...arguments),this.onSearchResultSet=e=>{this.forceUpdate()}}render(){const e=this.props.searchStatus&&this.props.searchStatus.searchResult&&this.props.searchStatus.searchResult.value;return s.createElement("div",{className:"search-provider flex flex-column flex-grow"},s.createElement("div",{className:"search-filter-bar"},"Place WIT filter bar components here ..."),s.createElement("div",{className:"search-results flex flex-column flex-grow"},this.props.searchStatus?e?e.matches&&e.matches.length?s.createElement("ul",null,e.matches.map(((e,t)=>s.createElement("li",{key:t},e.render())))):s.createElement("span",null,"No matches found"):s.createElement("span",null,"Waiting on results ..."):s.createElement("div",{className:"search-view-information-area"},s.createElement("div",{className:"search-view-information-title"},"Welcome to Workitem Search!"),s.createElement("div",{className:"search-view-information-summary"},"Find workitems in your Azure DevOps Services account",s.createElement("br",null),s.createElement("br",null),"Here are some ways to find the workitems you want:",s.createElement("ul",{className:"search-view-information-examples"},s.createElement("li",null,"Example 1 ..."),s.createElement("li",null,"Example 2 ..."),s.createElement("li",null,"Example 3 ...")),s.createElement("p",null,s.createElement("span",null,"For more ways to search, see the "),s.createElement("a",{href:"https://go.microsoft.com/fwlink/?LinkId=698587&clcid=0x409",id:"search-hub-helplink",target:"_blank"},"help page"),s.createElement("span",null,". "),s.createElement("span",null,"Send your feedback to "),s.createElement("a",{href:"mailto:vsosrch@microsoft.com",id:"search-hub-feedbacklink",target:"_top"},"vsosrch@microsoft.com"))))))}componentDidMount(){this.props.searchStatus&&this.props.searchStatus.searchResult.subscribe(this.onSearchResultSet)}componentWillReceiveProps(e){this.props.searchStatus&&this.props.searchStatus.searchResult.unsubscribe(this.onSearchResultSet),e.searchStatus&&e.searchStatus.searchResult.subscribe(this.onSearchResultSet)}componentWillUnmount(){this.props.searchStatus&&this.props.searchStatus.searchResult.unsubscribe(this.onSearchResultSet)}}t[e].WorkitemSearchResultComponent=r}("SearchResult"),function(e){w=t[e]={};class o extends i.VssService{execute(e){return{searchQuery:e,searchResult:new r.ObservableValue(void 0)}}render(e){return s.createElement(P.WorkitemSearchResultComponent,{searchStatus:e})}performAction(e){const t=e.queryText.match(/^\s*#?(\d{1,9})\s*$/),s=t?parseInt(t[1],10):0;if(s>0){const e=this.pageContext.getRestClient("IWorkItemTrackingRestClient"),t=this.pageContext.getService("IVssContributionService");return Promise.all([e.getWorkItem(s,void 0,["System.Id"]),t.getService("ms.vss-work-web.work-item-service")]).then((([e,t])=>(t&&t.openWorkItem(s),!0)),(e=>Promise.resolve(!1)))}return Promise.resolve(!1)}}t[e].WorkitemSearchBaseProvider=o}("BaseProvider"),function(e){W=t[e]={},t[e].WorkItemRoute="ms.vss-work-web.work-items-form-route-with-id",t[e].InfiniteScrollTakeValue=25,t[e].HubName="Boards",function(e){e.Feature="WorkItemSearchSuggestions",e.TTISearchScenarioName="WorkItemSearchTTIScenario",e.SubsequentSearchScenarioName="WorkItemSearchTTIScenario"}(t[e].CustomerIntelligenceConstants||(t[e].CustomerIntelligenceConstants={})),function(e){e.title="system.title",e.id="system.id",e.type="system.workitemtype"}(t[e].WitRef||(t[e].WitRef={})),function(e){e.DisableAggregations="WebAccess.Search.WorkItem.DisableAggregations",e.InfiniteScroll="WebAccess.Search.WorkItem.InfiniteScroll"}(t[e].FeatureFlags||(t[e].FeatureFlags={}))}("Constants"),function(e){var s;R=t[e]={},function(e){e.AssignedTo="system.assignedto",e.CreatedBy="system.createdby",e.State="system.state",e.WorkItemType="system.workitemtype"}(s=t[e].ShortcutFieldNames||(t[e].ShortcutFieldNames={})),t[e].ShortcutTexts={[s.AssignedTo]:"a",[s.CreatedBy]:"c",[s.State]:"s",[s.WorkItemType]:"t"},function(e){e.Today="@Today",e.Today1="@Today-1",e.Today7="@Today-7",e.Today30="@Today-30"}(t[e].ValueSuggestions||(t[e].ValueSuggestions={}));class r extends i.VssService{_serviceStart(s){super._serviceStart(s);const r=s.getRestClient("IWorkItemTrackingRestClient"),i=s.getService("ITfsPageService").getData(),o=i&&i.project?i.project.name:"";this.fieldsPromise=r.getFields(o).then((s=>s.map((s=>({field:s,shortcut:t[e].ShortcutTexts[s.referenceName.toLowerCase()]})))))}getFields(){return this.fieldsPromise}}t[e].WorkItemTrackingFieldService=r,i.Services.add("WorkItemTrackingFieldService",{serviceFactory:r})}("SearchFields"),function(e){N=t[e]={};const s="\\.,;'`:~\\\\/\\*\\|\\?\"&%$!\\+=\\(\\)\\[\\]{}<>-",r=":|<|>|<=|>=|!=",i=new RegExp("([^{0}\\s]+)\\s*(:|<=|>=|<|>|=|!=)\\s*([^{1}\\s]*)$".replace("{0}",s).replace("{1}",r)),o=new RegExp("([^{0}\\s]+)(\\s*)$".replace("{0}",s)),n=new RegExp('"([^{0}]+)"\\s*(:|<=|>=|<|>|=|!=)\\s*([^{1}"]*)$'.replace("{0}",s).replace("{1}",r)),a=new RegExp('"([^{0}]+)"\\s*$'.replace("{0}",s)),c=/(.*)\s*(:|<=|>=|<|>|=|!=)\s*\"([^\"]*)$/,u=new RegExp('"[^{0}]*$'.replace("{0}",s)),l=/(:|<=|>=|<|>|=|!=)/,h=[" ","<",">",":","=",'"',"!"];var d;!function(e){e[e.None=0]="None",e[e.Static=1]="Static",e[e.Fields=2]="Fields",e[e.Operators=3]="Operators",e[e.Values=4]="Values",e[e.Identity=5]="Identity"}(d=t[e].DropdownType||(t[e].DropdownType={})),t[e].defaultFieldsFilterGroup={caption:C.FilterByField,example:C.FilterByFieldExample,footer:C.FilterByFieldFooter,filters:[{text:`${R.ShortcutTexts[R.ShortcutFieldNames.AssignedTo]}:`,hint:C.AssignedToHint,getSuggestedText:y},{text:`${R.ShortcutTexts[R.ShortcutFieldNames.CreatedBy]}:`,hint:C.CreatedByHint,getSuggestedText:y},{text:`${R.ShortcutTexts[R.ShortcutFieldNames.State]}:`,hint:C.StateHint,getSuggestedText:y},{text:`${R.ShortcutTexts[R.ShortcutFieldNames.WorkItemType]}:`,hint:C.WITHint,getSuggestedText:y}]},t[e].defaultOperatorsFilterGroup={caption:C.Operators,example:C.OperatorsExample,singleLine:!0,filters:[{text:"AND",getSuggestedText:y},{text:"NOT",getSuggestedText:y},{text:"OR",getSuggestedText:y}]};const p={caption:"",filters:[{text:"=",getSuggestedText:y},{text:"!=",getSuggestedText:y},{text:">",getSuggestedText:y},{text:"<",getSuggestedText:y},{text:">=",getSuggestedText:y},{text:"<=",getSuggestedText:y}]};function g(e){return e&&e.replace(/\s+/g,"").toLowerCase()}function m(e,t){const s=v(e,t);return s[0]&&s[0].field?s[0].field.type:void 0}function S(e){const t=e.match(/\"/g);return!!((t?t.length:0)%2)}function I(e,t,s=!1,r=!0){t=r?t.replace(/[\s]+/g,""):t;const i=S(e)?['"']:h;let{endIndex:o,startIndex:n}=function(e,t){let s=e.length-1,r=e.length-1;for(;s>0&&t.indexOf(e.charAt(s))<0;)s--;for(;r<e.length-1&&-1===t.indexOf(e.charAt(r));)r++;const i=s>0?s+1:0,o=r<e.length-1?r-1:r;return{startIndex:i,endIndex:o,content:e.substr(i,o-i+1)}}(e,i);n>0&&'"'===e.charAt(n-1)&&S(e)&&(e=e.slice(0,n-1)+e.slice(n),n--,o--),s&&(t=`${t}:`),t=`${t} `;const a=e.substr(0,n).trim();return`${`${a}${""!==a?" ":""}${t}`}${e.substr(o+1).trim()}`}function y(e,t){return`${t} `}function v(e,t){return e.filter((e=>g(e.field.name)===g(t)||e.shortcut&&g(e.shortcut)===g(t)))}t[e].FieldSuggestionStore=class{constructor(){this.dropdownType=d.Static,this.getFilterGroups=(s,r)=>{if(this.textToFilter=this.getTextToFilter(s,r),this.dropdownType===d.Static)return[t[e].defaultFieldsFilterGroup,t[e].defaultOperatorsFilterGroup];if(this.dropdownType===d.Fields){const s=r.filter((e=>0===g(e.field.name).indexOf(g(this.textToFilter))));return[{caption:C.FilterByField,example:C.FilterByFieldExample,filters:s.map((e=>({text:e.field.name,getSuggestedText:(t,s)=>{return I(t,s,8===(r=e.field.type)||6===r||4===r||3===r||0===r||5===r||10===r||11===r);var r},shortcutText:e.shortcut,replaceTextOnActivation:!0})))},t[e].defaultOperatorsFilterGroup]}return this.dropdownType===d.Operators?[p]:this.dropdownType===d.Values?[{caption:"",filters:[{text:R.ValueSuggestions.Today,getSuggestedText:I,replaceTextOnActivation:!0},{text:R.ValueSuggestions.Today1,getSuggestedText:I,replaceTextOnActivation:!0},{text:R.ValueSuggestions.Today7,getSuggestedText:I,replaceTextOnActivation:!0},{text:R.ValueSuggestions.Today30,getSuggestedText:I,replaceTextOnActivation:!0}].filter((e=>0===g(e.text).indexOf(g(this.textToFilter))))}]:[]},this.getTextToFilter=(e,t)=>(this.dropdownType=d.Static,!e||e.length<=1&&S(e)?"":S(e)?this.handleForUnPairedQuote(e,t):this.handleForPairedQuote(e,t)),this.handleForPairedQuote=(e,t)=>{const s=e.lastIndexOf('"'),r=e=>{const s=e[1],r=e[3];return this.setSuggestionModeForOperators(s,r,t)},c=e=>{const s=e[2]&&" "===e[2].replace(/\s+/," "),r=e[1];return s?this.setSuggestionModeForFieldName(r,t):(this.dropdownType=d.Fields,r)};if(s<0){const t=e.match(i);if(t)return r(t);const s=e.match(o);return s?c(s):(this.dropdownType=d.Fields,e)}{const u=e.substr(s+1),l=u.match(i);if(l)return r(l);const h=e.match(n);if(h){const e=h[1],s=h[3];return this.setSuggestionModeForOperators(e,s,t)}const p=u.match(o);if(p)return c(p);const g=e.match(a);if(g){const e=g[1].replace(/\s+/g,"");return this.setSuggestionModeForFieldName(e,t)}return this.dropdownType=d.Static,""}},this.handleForUnPairedQuote=(e,t)=>{const s=e.match(c),r=e.match(u);if(s){if(":"===s[2]){const e=s[1].trim(),r=e.length;let i,o;if('"'===e[r-1]){for(o=r-2;'"'!==e.charAt(o)&&o>0;)o--;i=e.substring(o+1,r-1)}else{for(o=r-1;" "!==e.charAt(o)&&o>0;)o--;" "===e.charAt(o)&&o++,i=e.substr(o)}return this.setSuggestionModeForOperators(i,s[3],t)}return this.dropdownType=d.None,""}if(r){const t=e.lastIndexOf('"'),s=e.substr(t+1);return s?s.match(l)?this.dropdownType=d.None:this.dropdownType=d.Fields:this.dropdownType=d.Static,s}return this.dropdownType=d.None,""},this.setSuggestionModeForOperators=(e,t,s)=>{const r=m(s,e);return void 0===r?(this.dropdownType=d.None,""):(2===r?this.dropdownType=d.Values:10===r||function(e,t){const s=v(e,t);return s[0].field&&s[0].field.isIdentity}(s,e)?this.dropdownType=d.Identity:this.dropdownType=d.None,t)},this.setSuggestionModeForFieldName=(e,t)=>{const s=m(t,e);return s?2!==s&&7!==s&&1!==s||(this.dropdownType=d.Operators):this.dropdownType=d.Static,""}}},t[e].getSuggestedText=I}("FieldSuggestionStore"),function(e){t[e]={};class r extends u.BaseInstantSearchProvider{constructor(){super(...arguments),this._contributionId="ms.vss-work-web.board-project-menu-provider",this._recordBoardResultsClickTelemetry=(e,t)=>{t.publish("ResultClicked",{index:e,resultType:"BoardSearchResults"})}}_serviceStart(e){super._serviceStart(e),this._initContribution(this._contributionId),this._searchClient=this.pageContext.getRestClient("TFS_WIT_SEARCH.ISearchRestClient")}_initContribution(e){super._initContribution(e),this._contribution&&(this._boardsMenuProps=this._contribution.boardsMenuProps||{})}_getMenuItems(e,t,s,r){return s&&r?this.getSuggestions(r,t,"RecentBoardSearchResultsFetched"):this._menuItems.splice(0,this._menuItems.length),this._menuItems}_fetchResults(e,t){const s=this.projectProperties?this.projectProperties.id:"",{invokedProvidersProps:r}=t,i=r&&r.props?r.props.key:void 0,o=i?i.substr(1):"",n={searchText:e,$skip:0,$top:i?5:3,includeFacets:!1,$orderBy:[],filters:o?{boardType:[o]}:{}};return this._searchClient.fetchBoardSearchResults(n,s)}_onFetchSuccess(e,t,r){const{telemetryWriter:i,onFocus:u,searchInput:h,invokedProvidersProps:d}=t;if(this._menuItems.splice(0,this._menuItems.length),this.shouldInvokeProvider(t)&&!h.queryText().trim())return;const p=d&&d.props?d.props.header:C.BoardsHeader,g=d&&d.props?d.props.key:void 0;if(r&&r.results.length>0){this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:p,className:"search-suggestion-header"});const e=r.results,t=g?5:3,o=Math.min(t,e.length);for(let t=0;t<o;t++){const r=e[t],o=r.project,h=r.boardtype,d=r.team,{iconName:p,routeContribution:g}=this._boardsMenuProps[h];this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,renderMenuCell:(e,t,r)=>{if(r.onFocusItem=u,2===e){const e=(0,n.format)("{0} {1}",d.name,h.toLowerCase());return s.createElement(l.ResultRow,{iconProps:{iconName:p},title:e})}},onActivate:(e,s)=>{const r={project:o.name,teamName:d.name,pivot:h.toLowerCase()},n=(0,a.routeUrl)(this.pageContext,g,r);if(s.ctrlKey||s.metaKey){const e=window.open(n,"_blank");e&&e.opener&&(e.opener=null)}else(0,c.onClickFPS)(this.pageContext,n,!0,s);this._recordBoardResultsClickTelemetry(t,i)}})}}else if(r&&0===r.results.length||!r){if(g){const e=this.projectProperties?(0,n.format)(C.NoSearchSuggestionsInProjectMessage,this._getBoardTypeResourceText(g),this.projectProperties.name):(0,n.format)(C.NoSearchSuggestionsMessage,this._getBoardTypeResourceText(g));this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:p,className:"search-suggestion-header"},{id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:e,className:"suggestion-message"}),(0,o.announce)(e)}i.publish("NoSuggestionsFound",{type:"BoardSearchSuggestions"})}}_onFetchFail(e,t){const{invokedProvidersProps:s}=e,r=s&&s.props?s.props.header:C.BoardsHeader;this._menuItems.splice(0,this._menuItems.length),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:r,className:"search-suggestion-header"},{id:"",itemType:2,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:C.GenericErrorMessage}),(0,o.announce)(C.GenericErrorMessage)}get projectProperties(){if(!this._projectProperties){const e=this.pageContext.getService("ITfsPageService").getData();this._projectProperties=e?e.project:void 0}return this._projectProperties}_getBoardTypeResourceText(e){switch(e){case"/board":default:return C.BoardText;case"/sprint":return C.SprintText;case"/backlog":return C.BacklogText}}}t[e].BoardSuggestionsProvider=r,i.Services.add("project-board-provider-service",{serviceFactory:r})}("InstantSearchProvidersBoardSuggestionsProvider"),function(e){t[e]={};class s extends u.BaseInstantSearchProvider{constructor(){super(...arguments),this._contributionId="ms.vss-work-web.dayzero-message-menu-provider",this._isWorkitemAvailable=!0}_serviceStart(e){super._serviceStart(e),this._initContribution(this._contributionId),this._isBoardsAvailable=(0,h.isFeatureFlagEnabled)(e,"TeamFoundationRecentActivityService.DisplayUserProjectActivities",!1)}_getMenuItems(e,t,s,r){return s&&!r||(this._menuItems.length>0&&this._menuItems.splice(0,this._menuItems.length),this._isWorkitemAvailable=!0,this._isBoardsAvailable=!0),this._menuItems}updateWorkItemState(e){this._isWorkitemAvailable=e,this._updateDayZeroMessage()}updateBoardState(e){this._isBoardsAvailable=e,this._updateDayZeroMessage()}_updateDayZeroMessage(){this._menuItems.length>0&&this._menuItems.splice(0,this._menuItems.length),this._isBoardsAvailable||this._isWorkitemAvailable||(this._menuItems.push({id:"",itemType:0,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:C.DayZeroMessage}),(0,o.announce)(C.DayZeroMessage))}}t[e].DayZeroMessageProvider=s,i.Services.add("dayzero-message-provider-service",{serviceFactory:s})}("InstantSearchProvidersDayZeroMessageProvider"),function(e){t[e]={};class r extends u.BaseInstantSearchProvider{constructor(){super(...arguments),this._contributionId="ms.vss-work-web.recent-boards-menu-provider",this._recordWorkItemClickTelemetry=(e,t)=>{t.publish("ResultClicked",{index:e,resultType:"RecentBoards"})}}_serviceStart(e){super._serviceStart(e),this._initContribution(this._contributionId),this._contribution&&(this._recentBoardsProps=this._contribution.recentBoardsMenuProps||{}),this._dayZeroMessageService=this.pageContext.getService("dayzero-message-provider-service")}_getMenuItems(e,t,s,r){return s&&!r?this.getSuggestions("",t,"RecentBoardsFetched"):this._menuItems.splice(0,this._menuItems.length),this._menuItems}_fetchResults(e,t){const s=this.pageContext.getService("IVssContributionService"),{invokedProvidersProps:r}=t,i=r&&r.props?r.props.key:void 0,o=i?i.substr(1):"",n=o?{boardType:o}:void 0;return s.getDataAsync("ms.vss-work-web.boards-recent-activity-data-provider",n,!0)}_onFetchSuccess(e,t,r){const{telemetryWriter:i,onFocus:o,searchInput:a,invokedProvidersProps:u}=t;if(this._menuItems.splice(0,this._menuItems.length),!this.shouldInvokeProvider(t)||!a.queryText().trim())if(r&&r.length>0){const e=u&&u.props?u.props.emptyTextHeader:C.RecentBoardsHeader;this._dayZeroMessageService.updateBoardState(!0),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:e,className:"search-suggestion-header"});const t=Math.min(5,r.length);for(let e=0;e<t;e++){const t=r[e];this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,renderMenuCell:(e,r,i)=>{if(i.onFocusItem=o,2===e){var a=this._recentBoardsProps[t.artifactKind.toUpperCase()];const e=(0,n.format)("{0} {1}",t.name,a.boardType);return s.createElement(l.ResultRow,{iconProps:{iconName:a.iconName},title:e})}},onActivate:(s,r)=>{if(r.ctrlKey||r.metaKey){const e=window.open(t.artifactUri,"_blank");e&&e.opener&&(e.opener=null)}else(0,c.onClickFPS)(this.pageContext,t.artifactUri,!0,r);this._recordWorkItemClickTelemetry(e,i)}})}}else(r&&0===r.length||!r)&&(this._dayZeroMessageService.updateBoardState(!1),i.publish("NoSuggestionsFound",{type:"RecentBoards"}))}_onFetchFail(e,t){const{invokedProvidersProps:s}=e,r=s&&s.props?s.props.emptyTextHeader:C.RecentBoardsHeader;this._menuItems.splice(0,this._menuItems.length),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:r,className:"search-suggestion-header"},{id:"",itemType:2,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:C.GenericErrorMessage}),(0,o.announce)(C.GenericErrorMessage)}}t[e].RecentBoardsProvider=r,i.Services.add("recent-boards-provider-service",{serviceFactory:r})}("InstantSearchProvidersRecentBoardsProvider"),function(e){t.InstantSearchProvidersServicesDisplayWorkItemService={};class r extends i.VssService{displayWorkItem(e,t,r,i,o){if(r){const s=(0,a.routeUrl)(this.pageContext,W.WorkItemRoute,{project:t,id:e}),r=window.open(s,"_blank");r&&r.opener&&(r.opener=null)}else{const t=this.pageContext.getService("IVssLayoutManager");i&&i(!0),t.renderCallout((t=>s.createElement(d.LegacyComponent,{modules:["WorkItemTracking/SharedScripts/WorkItemDialogShim"],wrappedType:"WorkItemDialog",workItemId:Number(e),onDismiss:()=>{t(),i&&i(!1)}})))}o&&o()}}i.Services.add("IDisplayWorkItemService",{serviceFactory:r})}(),function(e){t[e]={};class r extends u.BaseInstantSearchProvider{constructor(){super(...arguments),this._contributionId="",this._recordWorkItemClickTelemetry=(e,t)=>{t.publish("ResultClicked",{index:e,resultType:"RecentWorkItem"})},this._displayWorkItem=(e,t,s,r,i)=>{this.pageContext.getService("IDisplayWorkItemService").displayWorkItem(e,t,s,r,i)}}_serviceStart(e){super._serviceStart(e),this._initContribution(this._contributionId),this._dayZeroMessageService=this.pageContext.getService("dayzero-message-provider-service")}_getMenuItems(e,t,s,r){return s&&!r?this.getSuggestions("",t,"CachedRecentWorkItemsFetched",W.CustomerIntelligenceConstants.TTISearchScenarioName,W.CustomerIntelligenceConstants.SubsequentSearchScenarioName):this._menuItems.splice(0,this._menuItems.length),this._menuItems}_fetchResults(e,t){return this.pageContext.getService("IPrefetchInstantSearchContentService").recentWorkItemsCache}_onFetchSuccess(e,t,r){const{searchInput:i,telemetryWriter:a,onFocus:c,invokedProvidersProps:u}=t;if(this._menuItems.splice(0,this._menuItems.length),!this.shouldInvokeProvider(t)||!i.queryText().trim())if(r&&r.length>0){const e=u&&u.props?u.props.emptyTextHeader:C.RecentWorkItemsHeader;this._dayZeroMessageService.updateWorkItemState(!0),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:e,className:"search-suggestion-header"});const t=Math.min(5,r.length);for(let e=0;e<t;e++){const t=r[e].data,o=t[0],u=t[1],h=t[2],d=t[3];this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,renderMenuCell:(e,t,r)=>{if(r.onFocusItem=c,2===e)return s.createElement(l.ResultRow,{workItemIconProps:{project:o,workItemType:d},title:h,mutedText:"#"+u,mutedTextAriaLabel:(0,n.format)(C.WorkItemIdAriaLabel,u)})},onActivate:(e,t)=>this._displayWorkItem(u,o,t&&t.ctrlKey,i.setHelpVisibility,(()=>this._recordWorkItemClickTelemetry(e.data,a)))})}(0,o.announce)(C.RecentWorkItemsLoadedMessage)}else(r&&0===r.length||!r)&&(this._dayZeroMessageService.updateWorkItemState(!1),a.publish("NoSuggestionsFound",{type:"RecentWorkItems"}))}_onFetchFail(e,t){const{invokedProvidersProps:s}=e,r=s&&s.props?s.props.emptyTextHeader:C.RecentWorkItemsHeader;this._menuItems.splice(0,this._menuItems.length),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:r,className:"search-suggestion-header"},{id:"",itemType:2,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:C.GenericErrorMessage}),(0,o.announce)(C.GenericErrorMessage)}}function a(e){return class extends r{constructor(){super(...arguments),this._contributionId=e}}}t[e].RecentWorkItemsProvider=r,i.Services.add("project-recent-workitems-provider-service",{serviceFactory:a("ms.vss-work-web.recent-workitems-project-menu-provider")}),i.Services.add("collection-recent-workitems-provider-service",{serviceFactory:a("ms.vss-work-web.recent-workitems-collection-menu-provider")})}("InstantSearchProvidersRecentWorkItemsProvider"),function(e){t[e]={};class r extends u.BaseInstantSearchProvider{constructor(){super(...arguments),this._contributionId="",this._providerId="",this._projectFilter="",this._displayWorkItem=(e,t,s,r,i)=>{this.pageContext.getService("IDisplayWorkItemService").displayWorkItem(e,t,s,r,i)},this._executeSearch=(e,t,s,r,i)=>{this.pageContext.getService("IExecuteSearchService").executeSearch(e,t,s,r,i)},this._recordWorkItemClickTelemetry=(e,t)=>{t.publish("ResultClicked",{index:e,resultType:"InstantSearchWorkItem"})},this._onViewAllResultsClick=(e,t,s)=>{t(!0),s.publish("ResultClicked",{index:e,resultType:"ViewAllWorkItemsLink"})}}_serviceStart(e){super._serviceStart(e),this._initContribution(this._contributionId),this._legacySearchClient=this.pageContext.getRestClient("Legacy.ISearchRestClient")}_getMenuItems(e,t,s,r){return s&&r?this.getSuggestions(r,t,"WorkItemSuggestionsFetched",W.CustomerIntelligenceConstants.TTISearchScenarioName,W.CustomerIntelligenceConstants.SubsequentSearchScenarioName):this._menuItems.splice(0,this._menuItems.length),this._menuItems}_initContribution(e){if(super._initContribution(e),this._contribution){const{searchProjectFilter:e,searchProviderId:t}=this._contribution;this._providerId=t||"",this._projectFilter=e||""}}_fetchResults(e,t){const s=this.projectProperties?this.projectProperties.id:"",r=this.projectProperties?this.projectProperties.name:"",i={searchText:e,skipResults:0,takeResults:5,summarizedHitCountsNeeded:!1,includeSuggestions:!1,searchFilters:r&&this._projectFilter?{[this._projectFilter]:[r]}:{},filters:[],sortOptions:[],isInstantSearch:!0};return this._legacySearchClient.postWorkItemQuery(i,s)}_onFetchSuccess(e,t,r,i){r.activityId&&r.activityId.length>0&&i.addProperties({responseActivityId:r.activityId[0]});const{searchInput:a,telemetryWriter:c,onFocus:u,invokedProvidersProps:h}=t;if(this._menuItems.splice(0,this._menuItems.length),this.shouldInvokeProvider(t)&&!a.queryText().trim())return;const d=h&&h.props?h.props.header:C.WorkItemsHeader,m=r.response,{values:S,count:I}=m.results,y=S,v=I;if(y&&y.length>0){this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:d,className:"search-suggestion-header"});const t=1===y.length;if(y.forEach(((e,r)=>{let i={};e.fields.map((e=>{i[e.referenceName]=e.value}));const o=i[W.WitRef.id],h=i[W.WitRef.type],d=i[W.WitRef.title],g=e.project;this._menuItems.push({id:"",className:(0,p.css)(t&&0===r&&"focused"),groupKey:this._groupKey,rank:this._rank,renderMenuCell:(e,t,r)=>{if(r.onFocusItem=u,2===e)return s.createElement(l.ResultRow,{workItemIconProps:{project:g,workItemType:h},title:d,mutedText:"#"+o,mutedTextAriaLabel:(0,n.format)(C.WorkItemIdAriaLabel,o)})},onActivate:(e,t)=>this._displayWorkItem(o,g,t&&t.ctrlKey,a.setHelpVisibility,(()=>this._recordWorkItemClickTelemetry(r,c)))})})),v>y.length){const t=(0,n.format)(C.ViewAllResults,(0,g.getFriendlyDisplayValue)(v));this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,renderMenuCell:(e,r,i)=>{if(i.onFocusItem=u,2===e)return s.createElement(l.ResultRow,{iconProps:{iconName:"Search"},title:t})},onActivate:(t,s)=>this._executeSearch(e,this._providerId,void 0,s.ctrlKey,(()=>this._onViewAllResultsClick(5,a.setHelpVisibility,c)))})}(0,o.announce)(1===y.length?C.SingleResultLoadedMessage:C.ResultsLoadedMessage)}else if(y&&0===y.length){const e=this.projectProperties?(0,n.format)(C.NoSearchSuggestionsInProjectMessage,C.WorkItemText,this.projectProperties.name):(0,n.format)(C.NoSearchSuggestionsMessage,C.WorkItemText);h&&this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:d,className:"search-suggestion-header"}),this._menuItems.push({id:"",itemType:2,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:e}),(0,o.announce)(e),c.publish("NoSuggestionsFound",{type:"InstantSearch"})}}_onFetchFail(e,t,s){t.activityId&&s.addProperties({responseActivityId:t.activityId});const{invokedProvidersProps:r}=e,i=r&&r.props?r.props.header:C.WorkItemsHeader;this._menuItems.splice(0,this._menuItems.length),this._menuItems.push({id:"",groupKey:this._groupKey,rank:this._rank,itemType:2,text:i,className:"search-suggestion-header"},{id:"",itemType:2,className:"suggestion-message",groupKey:this._groupKey,rank:this._rank,text:C.GenericErrorMessage}),(0,o.announce)(C.GenericErrorMessage)}get projectProperties(){if(!this._projectProperties){const e=this.pageContext.getService("ITfsPageService").getData();this._projectProperties=e?e.project:void 0}return this._projectProperties}}function a(e){return class extends r{constructor(){super(...arguments),this._contributionId=e}}}t[e].WorkItemSuggestionsProvider=r,i.Services.add("project-workitem-suggestions-provider-service",{serviceFactory:a("ms.vss-work-web.workitem-suggestions-project-menu-provider")}),i.Services.add("collection-workitem-suggestions-provider-service",{serviceFactory:a("ms.vss-work-web.workitem-suggestions-collection-menu-provider")})}("InstantSearchProvidersWorkItemSuggestionsProvider"),function(e){E=t[e]={};t[e].SearchWarmer=class{constructor(e){if(this.pageContext=e,this._isSearchWarmerEnabled=!1,this._warmerRunIntervalInSec=300,this._warmerIntervalSettingKey="Search/Wit/Warmer/Interval",this._timer=new m.TimerManagement,this._warmerRequest={searchText:"dummy-114B37FF-4996-4976-AE76-4B8DF19BF35D",skipResults:0,takeResults:0,summarizedHitCountsNeeded:!1,includeSuggestions:!1,searchFilters:{},filters:[],sortOptions:[],isInstantSearch:!1},this._isSearchWarmerEnabled=(0,h.isFeatureFlagEnabled)(this.pageContext,"WebAccess.Search.WorkItem.SearchWarmers",!1),this._isSearchWarmerEnabled){this._legacySearchClient=this.pageContext.getRestClient("Legacy.ISearchRestClient"),this._warmerRunIntervalInSec=(0,S.getSetting)(this.pageContext,this._warmerIntervalSettingKey,this._warmerRunIntervalInSec);const e=this.pageContext.getService("ITfsPageService").getData();e&&e.project&&(this._projectId=e.project.id)}}initSearchWarmers(){this._isSearchWarmerEnabled&&this.executeSearchWarmer()}executeSearchWarmer(){try{this._legacySearchClient.postWorkItemQuery(this._warmerRequest,this._projectId).then((e=>{e.response.errors.length>0&&"StopWarmerRequests"===e.response.errors[0].errorCode&&(this._isSearchWarmerEnabled=!1)}),(e=>{}))}catch(e){}finally{this._isSearchWarmerEnabled&&this._timer.setTimeout((()=>this.executeSearchWarmer()),1e3*this._warmerRunIntervalInSec)}}}}("SearchWarmer"),function(e){t.QueryProvider={};const r={caption:C.QueryHelpFilterGroupCaption,filters:[{text:C.AssignedToHint,getSuggestedText:(e,t)=>'a:"@Me"'},{text:C.CreatedByHint,getSuggestedText:(e,t)=>'c:"@Me"'},{text:C.StateHint,getSuggestedText:(e,t)=>'s:""'},{text:C.WITHint,getSuggestedText:(e,t)=>'t:""'}]};class o extends w.WorkitemSearchBaseProvider{help(e){return s.createElement(I.SearchHelpComponent,{filterGroups:[r],searchInput:e,onRenderFilterText:n})}}const n=(e,t)=>s.createElement("div",null,s.createElement(y.VssIcon,{iconName:"FilterSolid",iconType:0,className:"workitem-query-filter-icon"}),s.createElement("span",{className:"workitem-query-filter-text"},e.text));i.Services.add("workitem-query-provider",{serviceFactory:o})}(),function(e){M=t[e]={};class r extends v.VssComponent{constructor(e,t){super(e),this.renderNoIdentitiesFound=()=>s.createElement("div",{className:"search-people-picker-no-results flex-row flex-grow flex-center"},C.IdentityPickerNoResultsText),this.renderSuggestionItem=e=>s.createElement("div",{tabIndex:-1,className:"suggestion-item-container"},s.createElement(f.IdentityPickerSuggestionItem,Object.assign({},e))),this.onKeyDown=e=>{const t=5<this.state.suggestions.length?5:this.state.suggestions.length,{selectedIndex:s}=this.state;if(40===e.keyCode)this.setState({selectedIndex:(s+1)%t});else if(38===e.keyCode){const e=0===s?t-1:s-1;this.setState({selectedIndex:e})}else if(13===e.keyCode){const e=`"${this.getIdentityName(this.state.suggestions[s])}"`,t=(0,N.getSuggestedText)(this.props.searchInput.queryText(),e,!1,!1);this.props.searchInput.replaceText(t),this.setState({areSuggestionsVisible:!1})}e.stopPropagation()},this.componentDidMount=()=>{this.getSuggestions(this.props.searchText)},this.componentWillReceiveProps=e=>{this.getSuggestions(e.searchText)},this.componentWillUnmount=()=>{this.timerManagement.dispose()},this.getSuggestions=e=>{e&&""!==e.trim()?this.updateSuggestionsOnType(this.pickerProvider.onFilterIdentities(e,[])):this.updateSuggestions(this.pickerProvider.onEmptyInputFocus())},this.updateSuggestions=e=>{const t=e,s=e;Array.isArray(t)?this.setState({suggestions:t,suggestionsLoading:!1}):s&&s.then&&s.then((e=>{this.setState({suggestions:e,suggestionsLoading:!1})}))},this.onSuggestionClicked=e=>{const t=`"${this.getIdentityName(e.item)}"`,s=(0,N.getSuggestedText)(this.props.searchInput.queryText(),t,!1,!1);this.props.searchInput.replaceText(s),this.setState({areSuggestionsVisible:!1,selectedIndex:e.index})},this.getIdentityName=e=>{if(!e)return"";const t=e.signInAddress||e.mail;return t?-1===t.indexOf("@")&&e.scopeName?`${e.displayName} <${e.scopeName}\\${t}>`:`${e.displayName} <${t}>`:e.displayName||""},this.state={suggestions:[],areSuggestionsVisible:!0,openedIdentityCard:void 0,selectedIndex:0,suggestionsLoading:!0},this.pickerProvider=new k.PeoplePickerProvider(t.pageContext,{query:this.props.searchInput.queryText(),identityTypes:["user"],operationScopes:["ims","source"]}),this.timerManagement=new m.TimerManagement,this.updateSuggestionsOnType=this.timerManagement.debounce(this.updateSuggestions,150)}render(){return s.createElement(_.Observer,{suggestionsVisible:this.state.areSuggestionsVisible,suggestionsLoading:this.state.suggestionsLoading,selectedIndex:this.state.selectedIndex,suggestions:this.state.suggestions},(e=>e.suggestionsVisible?s.createElement("div",{className:"people-picker-container",onKeyDown:this.onKeyDown},s.createElement(x.SuggestionsList,Object.assign({},this.props,{className:"WIT-suggestions-list",isLoading:e.suggestionsLoading,loadingText:C.IdentityPickerLoadingText,renderNoResultFound:this.renderNoIdentitiesFound,renderSuggestion:this.renderSuggestionItem,resultsMaximumNumber:5,suggestionsItemClassName:"WIT-suggestions-item",suggestions:e.suggestions,selectedIndex:e.selectedIndex,onSuggestionClicked:this.onSuggestionClicked}))):s.createElement("div",null)))}}t[e].WITIdentityPicker=r}("WitPeoplePicker"),function(e){A=t[e]={};class r extends v.VssComponent{constructor(e){super(e),this.onChange=e=>{this.context.pageContext.getService("WorkItemTrackingFieldService").getFields().then((t=>{const s=this.fieldSuggestionStore.getFilterGroups(e,t),r=this.fieldSuggestionStore.textToFilter,i=this.fieldSuggestionStore.dropdownType,o=this.fieldSuggestionStore.dropdownType===N.DropdownType.None;o?this.props.searchInput.setHelpVisibility(o):this.setState({filterGroups:s,filterText:r,dropdownType:i})}))},this._notifyFilterActivated=e=>{this.context.pageContext.getService("IVssTelemetryService").publishEvent("L1SearchBox","WorkItem.SearchHelpFilterActivated",{filterText:e&&e.text,entity:"WorkItem"})},this.state={filterGroups:[],filterText:"",dropdownType:N.DropdownType.None},this.fieldSuggestionStore=new N.FieldSuggestionStore}render(){const{filterGroups:e,filterText:t,dropdownType:r}=this.state;return r!==N.DropdownType.Identity?s.createElement(I.SearchHelpComponent,{filterGroups:e,helpLink:"https://docs.microsoft.com/en-us/azure/devops/project/search/functional-work-item-search?view=azure-devops",searchInput:this.props.searchInput,filterText:t,onRenderFilterText:i,onItemActivated:this._notifyFilterActivated}):r===N.DropdownType.Identity?s.createElement(M.WITIdentityPicker,{searchInput:this.props.searchInput,searchText:t}):null}componentDidMount(){const e=this.props.searchInput.queryText();e?this.onChange(e):this.setState({filterGroups:[N.defaultFieldsFilterGroup,N.defaultOperatorsFilterGroup]}),this.props.searchInput.subscribe(this.onChange)}componentWillUnmount(){this.props.searchInput.unsubscribe(this.onChange)}}t[e].WorkitemSearchHelpComponent=r;const i=(e,t)=>{const r=(t=t.replace(/[\s]+/g," ").toLowerCase()).search(/\s/)>0;if(!t)return e.text;let i,o;if(r)i=e.text.substring(t.length),o=e.text.substring(0,t.length);else{let s=e.text.indexOf(" "),r=t.length;for(;s>0&&r>s;)r+=1,s=e.text.indexOf(" ",s+1);i=e.text.substring(r),o=e.text.substring(0,r)}return s.createElement(T.FormatComponent,{format:`${o}{0}`},s.createElement("span",{style:{fontWeight:700}},i))};v.VssComponent.register("search.workItem.help",r)}("SearchHelp"),function(e){t.SearchProvider={};class r extends w.WorkitemSearchBaseProvider{constructor(){super(...arguments),this._workItemSearchSuggestionsComponentRef=s.createRef(),this._searchWarmerInitialized=!1}getQuery(e){const t=Object.assign({type:"workitem",filters:{}},e),s=this.pageContext.getService("ITfsPageService").getData();return s&&s.project&&(t.filters.Projects=[s.project.name]),(0,h.isFeatureFlagEnabled)(this.pageContext,W.FeatureFlags.InfiniteScroll,!1)&&(t.pageSize=W.InfiniteScrollTakeValue),(0,h.isFeatureFlagEnabled)(this.pageContext,W.FeatureFlags.DisableAggregations,!1)&&(t.includeFacets=!1),t}help(e){this._searchWarmerInitialized||(this.searchWarmer.initSearchWarmers(),this._searchWarmerInitialized=!0);return(0,h.isFeatureEnabled)(this.pageContext,"ms.vss-tfs-web.enable-search-suggestions",!1)?s.createElement(F.InstantSearchSuggestionsComponent,{ref:this._workItemSearchSuggestionsComponentRef,hubName:W.HubName,featureName:W.CustomerIntelligenceConstants.Feature,searchInput:e}):s.createElement(A.WorkitemSearchHelpComponent,{searchInput:e})}performAction(e){return super.performAction(e).then((t=>{const s=(0,h.isFeatureEnabled)(this.pageContext,"ms.vss-tfs-web.enable-search-suggestions",!1);if(!t&&s){if(!this.pageContext.getService("IInvokedProvidersManager").shouldAllowImmersiveSearch())return!0;const t=this._workItemSearchSuggestionsComponentRef.current;if(t&&!e.openInNewWindow)return t.invokeActionOfSelectedItem(),!0;e.queryText=(0,S.getQueryTextWithWildCardChar)(e.queryText),this.telemetryWriter.publish("ImmersiveSearchPerformed")}return t}))}get telemetryWriter(){return this._telemetryWriter||(this._telemetryWriter=new b.TelemetryWriter(this.pageContext,W.CustomerIntelligenceConstants.Feature)),this._telemetryWriter}get searchWarmer(){return this._searchWarmer||(this._searchWarmer=new E.SearchWarmer(this.pageContext)),this._searchWarmer}}i.Services.add("workitem-search-provider",{serviceFactory:r})}()}),["Resources","SearchResult","BaseProvider","Constants","SearchFields","FieldSuggestionStore","InstantSearchProviders/BoardSuggestionsProvider","InstantSearchProviders/DayZeroMessageProvider","InstantSearchProviders/RecentBoardsProvider","InstantSearchProviders/Services/DisplayWorkItemService","InstantSearchProviders/RecentWorkItemsProvider","InstantSearchProviders/WorkItemSuggestionsProvider","SearchWarmer","QueryProvider","WitPeoplePicker","SearchHelp","SearchProvider"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.search-content"}}));