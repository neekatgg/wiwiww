"use strict";define("Agile/Directory",["require","exports","VSSUI/InfoIcon","VSSUI/Link","react","VSS/Platform/Layout","VSSUI/TooltipEx","VSSUI/VssIcon","Favorites/Star/FavoritesStarButton","OfficeFabric/DetailsList","VSSUI/Spinner","TFS/TeamPanel/TeamPanelIcon/TeamPanelIcon","VSSUI/Util","VSSUI/Components/VssDetailsList/VssDetailsList","redux/Utils/ActionHelper","VSS/Platform/Util/Array","immer","Reselect","VSS/Core/Util/String","VSS/Redux/Deprecated/HubViewState/index","redux-saga","Tfs/ReduxCommon/Modules/TfsPageData/TfsPageDataSelectors","VSS/Platform/Trace","redux","Tfs/ReduxCommon/Modules/TfsPageData/TfsPageData","OfficeFabric/Selection","react-redux","VSSUI/FilterBar","VSSUI/TextFilterBarItem","VSSUI/PickList","Agile/Common/Components/AssetResolver/AssetResolver","Agile/Common/Components/HubError/HubError","VSS/Redux/Modules/Navigation/index","VSS/Platform/Components/Format","VSS/Redux/Modules/TTIMonitor/index","VSSUI/Components/ZeroData/index","VSSUI/Header","VSSUI/Page"],(function(e,t,r,o,i,a,n,s,c,l,d,u,y,f,p,m,g,D,v,C,S,R,A,F,I,h,E,T,_,w,N,G,x,K,b,L,O,M){var P,k,V,U,B,j,Y,H,$,Z,z,W,J,q,X,Q,ee,te,re;P=t[re="Resources"]={},t[re].AllGroupHeading="All teams",t[re].DefaultArtifactName="Items",t[re].DeletedContent="Deleted",t[re].FavoriteGroupHeading="My favorite",t[re].FavoritesEmptyText="No favorites yet! Favorite {0} {1} to quickly access them here.",t[re].FilterAriaLabel="Show Filter",t[re].KeywordFilterPlaceholder="Filter by text",t[re].LoadingMessage="Loading...",t[re].MemberGroupHeading="My team",t[re].NameColumnHeader="Name",t[re].NoResultsFound="No Results Found",t[re].RecentGroupHeading="Continue where you left off",t[re].TeamColumnHeader="Team",t[re].TeamFilterPlaceholder="Team",function(e){k=t[e]={},function(e){e.Name="Name",e.Team="Team"}(t[e].DirectoryColumnKeys||(t[e].DirectoryColumnKeys={})),function(e){e.DIRECTORY_ROWITEM="directory-rowitem",e.DIRECTORY_GROUP_SPACER="directory-group-spacer",e.DIRECTORY_COLUMN="directory-column",e.DIRECTORY_COLUMN_HEADER="directory-column-header",e.DIRECTORY_DELETED_FAVORITE_CONTAINER="directory-deleted-favorite-container"}(t[e].DirectoryCSS||(t[e].DirectoryCSS={}))}("ComponentsDirectoryGridDirectoryGridConstants"),t.DirectoryContracts={},function(e){V=t[e]={};class l extends i.PureComponent{constructor(){super(...arguments),this._onFavorite=e=>{const{row:t,onFavoriteToggled:r}=this.props;e.stopPropagation(),r&&r(t)},this._onClicked=e=>{const{row:t,onClick:r}=this.props;e.ctrlKey||e.metaKey||e.shiftKey||!r||(e.preventDefault(),r(t,void 0,e.nativeEvent))}}render(){const{row:{data:{name:e,url:t},errorMessage:l,isDeleted:d,isFavorited:u,iconProps:y}}=this.props;return i.createElement("div",{className:"directory-row-name-cell"},y&&i.createElement(s.VssIcon,Object.assign({},y,{className:"directory-artifact-icon"})),i.createElement(n.Tooltip,{overflowOnly:!0,text:e},i.createElement("span",{className:"directory-row-title flex-tooltip-host"},d?`${e} (${P.DeletedContent})`:i.createElement(o.Link,{className:"directory-title",href:t,onClick:this._onClicked},e))),i.createElement("div",{className:(0,a.css)("directory-row-favorite",u&&"favorited")},i.createElement(c.FavoritesStarButton,{className:"directory-row-favorite-icon",isFavorited:u,onToggleFavorite:this._onFavorite})),i.createElement("div",{className:"directory-row-error"},l&&i.createElement(r.InfoIcon,{infoText:l,iconProps:{iconType:0,iconName:"Error"}}),l&&i.createElement("div",{className:"directory-row-error-annoucement screenreader","aria-live":"assertive"},l)))}}t[e].NameCell=l}("ComponentsDirectoryGridNameCell"),function(e){U=t[e]={};class r extends i.PureComponent{constructor(){super(...arguments),this._renderCell=(e,t,r)=>{if(r.key===this.props.columnKey)return i.createElement("div",{className:k.DirectoryCSS.DIRECTORY_ROWITEM},e.toggleable&&i.createElement(s.VssIcon,{className:(0,a.css)("directory-group-chevron",!e.collapsed&&"expanded"),iconName:"ChevronRight",iconType:0}),e.iconProps&&i.createElement(s.VssIcon,Object.assign({},e.iconProps,{className:"directory-group-icon"})),i.createElement(n.Tooltip,{overflowOnly:!0,text:e.title},i.createElement("div",{className:"directory-row-group-title"},i.createElement("span",{className:"flex-tooltip-host"},e.title))))},this._onClicked=()=>{const{row:e,onToggled:t}=this.props;t&&e.toggleable&&t(e,!e.collapsed)},this._onKeyDown=e=>{const{row:t,onToggled:r}=this.props;r&&t.toggleable&&(!t.collapsed&&39===e.keyCode||t.collapsed&&37===e.keyCode)&&(r(t,!t.collapsed),e.preventDefault())}}render(){const{row:{collapsed:e,title:t,toggleable:r}}=this.props;return i.createElement("div",{onClick:this._onClicked,onKeyDown:this._onKeyDown},i.createElement(l.DetailsRow,Object.assign({},this.props,{"aria-label":t,"aria-expanded":!e,onRenderItemColumn:this._renderCell,className:(0,a.css)("directory-group-row",!r&&"directory-group-row--disabled")})))}}t[e].GroupRow=r}("ComponentsDirectoryGridGroupRow"),function(e){B=t[e]={};class r extends i.PureComponent{constructor(){super(...arguments),this._renderCell=(e,t,r)=>{const{columnKey:o,isGrouped:a}=this.props;if(r.key===o)return i.createElement("div",{className:k.DirectoryCSS.DIRECTORY_ROWITEM},a&&i.createElement("div",{className:k.DirectoryCSS.DIRECTORY_GROUP_SPACER}),i.createElement("div",{className:"directory-row-title directory-row-spinner"},i.createElement(d.Spinner,{className:"directory-spinner"}),"Loading..."))}}render(){return i.createElement(l.DetailsRow,Object.assign({},this.props,{onRenderItemColumn:this._renderCell}))}}t[e].LoadingRow=r}("ComponentsDirectoryGridLoadingRow"),function(e){j=t[e]={};class r extends i.PureComponent{render(){const{row:{data:e},project:t}=this.props;if(!e||!e.owners||0===e.owners.length)return i.createElement("div",null);const r=e.owners.map((e=>e.name)).join(", ");return i.createElement("div",{className:"directory-row-team-cell"},i.createElement(u.TeamPanelIconButton,{projectName:t.name,projectId:t.id,teamId:e.owners[0].id,teamName:e.owners[0].name}),i.createElement(n.Tooltip,{overflowOnly:!0,text:r},i.createElement("span",{className:"team-name flex-tooltip-host"},r)))}}t[e].TeamCell=r}("ComponentsDirectoryGridTeamCell"),function(e){Y=t[e]={},t[e].DEFAULT_NAME_COLUMN={fieldName:k.DirectoryColumnKeys.Name,key:k.DirectoryColumnKeys.Name,name:P.NameColumnHeader,minWidth:400,maxWidth:600,headerClassName:k.DirectoryCSS.DIRECTORY_COLUMN_HEADER,className:k.DirectoryCSS.DIRECTORY_COLUMN,isResizable:!0,columnActionsMode:l.ColumnActionsMode.disabled},t[e].DEFAULT_TEAM_COLUMN={fieldName:k.DirectoryColumnKeys.Team,key:k.DirectoryColumnKeys.Team,name:P.TeamColumnHeader,isResizable:!0,minWidth:200,maxWidth:600,headerClassName:k.DirectoryCSS.DIRECTORY_COLUMN_HEADER,className:k.DirectoryCSS.DIRECTORY_COLUMN,columnActionsMode:l.ColumnActionsMode.disabled};class r extends i.Component{constructor(){super(...arguments),this._onRenderRow=e=>{const{columns:t,isGrouped:r,onRenderZeroDataRow:a}=this.props;return this._isGroupRow(e.item)?i.createElement(U.GroupRow,Object.assign({columnKey:t[0].key,row:e.item,onToggled:this._onGroupRowToggled},e,{ref:null,componentRef:null})):this._isZeroDataRow(e.item)?i.createElement(o,Object.assign({columnKey:t[0].key,isGrouped:r,onRenderRowContent:a,row:e.item},e,{ref:null,componentRef:null})):this._isLoadingRow(e.item)?i.createElement(B.LoadingRow,Object.assign({columnKey:t[0].key,isGrouped:r,row:e.item},e,{ref:null,componentRef:null})):i.createElement(l.DetailsRow,Object.assign({},e))},this._getPageSpecification=(e,t)=>{const{isGrouped:r,rows:o}=this.props;if(r){const t=o[e];if(t){let r=0,i=this._getRowGroupKey(t);const a=o.filter((e=>this._getRowGroupKey(e)===i)).findIndex((e=>e.key===t.key));for(let t=e;r<10&&t<o.length;t++){const e=o[t];if(this._getRowGroupKey(e)!==i)break;r++}return{itemCount:r,height:36*r,data:null,key:`p-${i}-${a}`}}}return{itemCount:10,height:360,data:null,key:`p-${e}`}},this._onRenderCell=(e,t,r)=>{const{columns:o,isGrouped:a,onRenderCell:n=this._defaultOnRenderCell}=this.props;return i.createElement("div",{className:k.DirectoryCSS.DIRECTORY_ROWITEM},a&&r.key===o[0].key&&i.createElement("div",{className:k.DirectoryCSS.DIRECTORY_GROUP_SPACER}),n(e,t,r,this._defaultOnRenderCell))},this._defaultOnRenderCell=(e,t,r,o)=>{switch(r.fieldName){case k.DirectoryColumnKeys.Name:return this._renderNameCell(e,t);case k.DirectoryColumnKeys.Team:return this._renderTeamCell(e);default:return null}},this._getContextMenuItems=e=>{const{getContextMenuItems:t}=this.props;return t&&!this._isGroupRow(e)?t(e):[]},this._onFavoriteToggled=e=>{const{onFavoriteToggled:t}=this.props;t&&t(e)},this._onGroupRowToggled=(e,t)=>{const{onGroupToggled:r}=this.props;r&&r(e.key,t)},this._onRowClicked=(e,t,r)=>{const{onItemClicked:o}=this.props;o&&o(e,r)},this._onRowInvoked=(e,t,r)=>{if(!this._isGroupRow(e)){e.isDeleted||this._onRowClicked(e,t,r)}},this._getRowKey=e=>e.key,this._shouldDisplayActions=e=>{const{getContextMenuItems:t}=this.props;return!!t&&!this._isGroupRow(e)}}render(){const{className:e,columns:t,rows:r,getContextMenuItems:o,takeFocusOnMount:a}=this.props;return i.createElement("div",{className:(0,y.css)("new-directory-grid-container",e)},i.createElement(f.VssDetailsList,{setKey:"sprints-gridview",layoutMode:l.DetailsListLayoutMode.justified,constrainMode:l.ConstrainMode.unconstrained,isHeaderVisible:!0,columns:t,className:"directory-gridview",items:r,listProps:{getPageSpecification:this._getPageSpecification},onRenderItemColumn:this._onRenderCell,selectionMode:l.SelectionMode.single,initialFocusedIndex:a&&!this._hasMounted?0:-1,getKey:this._getRowKey,onRenderRow:this._onRenderRow,selectionPreservedOnEmptyClick:!0,allocateSpaceForActionsButtonWhileHidden:!0,actionsColumnKey:k.DirectoryColumnKeys.Name,getMenuItems:o?this._getContextMenuItems:void 0,shouldDisplayActions:this._shouldDisplayActions,onItemInvoked:this._onRowInvoked}))}componentDidMount(){this._hasMounted=!0}_getRowGroupKey(e){return this._isGroupRow(e)?e.key:e.groupKey}_renderNameCell(e,t){return i.createElement(V.NameCell,{row:e,onFavoriteToggled:this._onFavoriteToggled,onClick:this._onRowClicked})}_renderTeamCell(e){return e.data.owners&&e.data.owners.length>0?i.createElement(j.TeamCell,{row:e,project:this.props.project}):null}_isZeroDataRow(e){return e.hasOwnProperty("isZeroDataRow")&&e.isZeroDataRow}_isGroupRow(e){return e.hasOwnProperty("isGroupRow")&&e.isGroupRow}_isLoadingRow(e){return e.hasOwnProperty("isLoadingRow")&&e.isLoadingRow}}t[e].DirectoryGrid=r;class o extends i.PureComponent{constructor(){super(...arguments),this._renderCell=(e,t,r)=>{const{columnKey:o,onRenderRowContent:a,isGrouped:n}=this.props;if(r.key===o)return i.createElement("div",{className:k.DirectoryCSS.DIRECTORY_ROWITEM},n&&i.createElement("div",{className:k.DirectoryCSS.DIRECTORY_GROUP_SPACER}),i.createElement("div",{className:"directory-row-title"},a&&a(e.groupKey)))}}render(){return i.createElement(l.DetailsRow,Object.assign({},this.props,{onRenderItemColumn:this._renderCell}))}}}("ComponentsDirectoryGridDirectoryGrid"),function(e){H=t[e]={},__exportStar(Y,t[e]),__exportStar(k,t[e])}("ComponentsDirectoryGridindex"),function(e){$=t[e]={},function(e){e.ARTIFACT_SCOPE_TYPE="Project",e.LOCAL_STORAGE_KEY_PREFIX="Directory_Group_State"}(t[e].DirectoryConstants||(t[e].DirectoryConstants={})),function(e){e.KEYWORD_FILTER_KEY="Keyword",e.TEAM_FILTER_KEY="Team"}(t[e].DirectoryFilterKeys||(t[e].DirectoryFilterKeys={})),function(e){e.MineGroupKey="MINE",e.RecentGroupKey="RECENT",e.FavoriteGroupKey="FAVORITE",e.AllGroupKey="ALL"}(t[e].DirectoryGroupKeys||(t[e].DirectoryGroupKeys={})),function(e){e.DIRECTORY_DATA_INITIALIZED="Directory_DataInitialized",e.DIRECTORY_ALL_DATA_INITIALIZED="Directory_AllDataInitialized",e.DIRECTORY_DATA_INITIALIZE_FAILED="Directory_DataInitialized_Failed",e.DIRECTORY_ALL_DATA_INITIALIZE_FAILED="Directory_AllDataInitialized_Failed",e.TEAMS_COUNT="Directory_TeamsCount",e.FAVORITE_COUNT="Directory_FavoriteCount"}(t[e].DirectoryTelemetryConstants||(t[e].DirectoryTelemetryConstants={}))}("DirectoryConstants"),function(e){Z=t[e]={},t[e].DirectoryActions={initialDataLoaded:e=>(0,p.trackedAction)((0,p.createAction)("Directory/InitialDataLoaded",e),{[$.DirectoryTelemetryConstants.TEAMS_COUNT]:e.artifacts.length,[$.DirectoryTelemetryConstants.FAVORITE_COUNT]:e.favorites?e.favorites.length:0}),initialDataLoadFailed:e=>(0,p.createAction)("Directory/InitialDataLoadFailed",e),beginLoadAllData:()=>(0,p.createAction)("Directory/BeginLoadAllData"),loadAllDataSucceeded:e=>(0,p.trackedAction)((0,p.createAction)("Directory/LoadAllDataSucceeded",e),{[$.DirectoryTelemetryConstants.TEAMS_COUNT]:e.artifacts.length}),loadAllDataFailed:e=>(0,p.createAction)("Directory/LoadAllDataFailed",e),artifactUpdated:(e,t)=>(0,p.createAction)("Directory/ArtifactUpdated",{artifactId:e,artifact:t}),rowGroupCollapsedInitialized:e=>(0,p.createAction)("Directory/RowGroupCollapsedInitialized",e),rowGroupToggled:(e,t)=>(0,p.createAction)("Directory/RowGroupToggled",{rowGroupKey:e,collapsed:t}),toggleFilter:()=>(0,p.createAction)("Directory/ToggleFilter")}}("ReduxDirectoryActions"),function(e){z=t[e]={},t[e].FavoriteActions={toggleFavorite:(e,t,r,o)=>(0,p.createAction)("Directory/ToggleFavorite",{artifactId:e,artifactName:t,favoriteType:r,favoriteId:o}),beginAddFavorite:e=>(0,p.createAction)("Directory/BeginAddFavorite",e),addFavoriteSuccessful:e=>(0,p.createAction)("Directory/AddFavoriteSuccessful",e),addFavoriteFailed:(e,t)=>(0,p.createAction)("Directory/AddFavoriteFailed",{artifactId:e,error:t}),beginRemoveFavorite:e=>(0,p.createAction)("Directory/BeginRemoveFavorite",e),removeFavoriteSuccessful:e=>(0,p.createAction)("Directory/RemoveFavoriteSuccessful",e),removeFavoriteFailed:(e,t)=>(0,p.createAction)("Directory/RemoveFavoriteFailed",{artifactId:e,error:t})}}("ReduxFavoritesFavoriteActions"),function(e){function r(){return{artifacts:{},deletedArtifacts:{},memberArtifactKeys:[],recentArtifactKeys:[]}}W=t[e]={},t[e].artifactReducer=function(e,t){return e=e||{artifacts:{},deletedArtifacts:{},memberArtifactKeys:[],recentArtifactKeys:[]},(0,g.default)(e,(r=>{switch(t.type){case"Directory/InitialDataLoaded":if(r.artifacts=Object.assign(Object.assign({},e.artifacts),(0,m.toLookup)(t.payload.artifacts,(e=>e.id))),r.memberArtifactKeys=t.payload.memberKeys,r.recentArtifactKeys=t.payload.recentKeys,t.payload.favorites)for(const e of t.payload.favorites)e.isDeleted&&(r.deletedArtifacts[e.artifactId]={id:e.artifactId,name:e.artifactName,favoriteType:e.artifactType});break;case"Directory/LoadAllDataSucceeded":r.artifacts=Object.assign(Object.assign({},e.artifacts),(0,m.toLookup)(t.payload.artifacts,(e=>e.id)));break;case"Directory/ArtifactUpdated":{const{artifact:e,artifactId:o}=t.payload;r.artifacts[o]=e;break}case"Directory/RemoveFavoriteSuccessful":{const o=t.payload;e.deletedArtifacts[o]&&delete r.deletedArtifacts[o]}}}))},t[e].getDefaultState=r}("ReduxArtifactsArtifactReducer"),function(e){function r(e){return e.directoryState.directoryArtifactState.artifacts||{}}function o(e){return e.directoryState.directoryArtifactState.deletedArtifacts||{}}function i(e){return e.directoryState.directoryArtifactState.memberArtifactKeys||[]}function a(e){return e.directoryState.directoryArtifactState.recentArtifactKeys||[]}function n(e){return e.directoryState.favoriteState}function s(e){return n(e).favoriteStatuses}function c(e){return e.directoryState.uiState.rowGroupCollapsedMap}function l(e){return e.directoryState.uiState.exceptionInfo}function d(e){return e.directoryState.uiState.isAllSectionLoading}function u(e){return e.directoryState.uiState.isAllSectionPopulated}function y(e){return e.directoryState.favoriteState.favorites}function f(e){return e.directoryState.favoriteState.favoriteErrors}function p(e,t){return t.artifactIcon}function m(e,t){return t.artifactName||P.DefaultArtifactName}function g(e,t){return e||t?e?t?(0,v.localeIgnoreCaseComparer)(e.name,t.name):-1:1:0}function S(e){return e.groupKey===$.DirectoryGroupKeys.RecentGroupKey||e.groupKey===$.DirectoryGroupKeys.AllGroupKey||!e.items||e.items.length<=0?e.groupHeader:`${e.groupHeader} (${e.items.length})`}J=t[e]={},t[e].getArtifactMap=r,t[e].getDeletedArtifactMap=o,t[e].getArtifactById=function(e){return t=>t.directoryState.directoryArtifactState.artifacts[e]},t[e].getMemberKeys=i,t[e].getRecentKeys=a,t[e].getFavoriteState=n,t[e].getFavoriteStatus=function(e){return t=>n(t).favoriteStatuses[e]},t[e].getFavoriteStatuses=s,t[e].getGroupCollapsedMap=c,t[e].isFilterVisible=function(e){return e.directoryState.uiState.isFilterBarVisible},t[e].getExceptionInfo=l,t[e].isAllSectionLoading=d,t[e].isAllSectionPopulated=u,t[e].getFavoriteMap=y,t[e].getFavoriteErrors=f,t[e].getArtifactIcon=p,t[e].getArtifactName=m,t[e].createInstanceSelectors=function(){const e=D.createSelector([n],(e=>{const t=e.favorites||{},r=e.favoriteStatuses||{};return Object.keys(t).filter((e=>3===r[e]||1===r[e])).map((e=>t[e]))})),t=D.createSelector([e,r,o],((e,t,r)=>e.map((e=>e.isDeleted?r[e.artifactId]:t[e.artifactId])).filter((e=>e)).sort(g))),R=D.createSelector([a,r],((e,t)=>e.map((e=>t[e])).sort(g))),A=D.createSelector([i,r],((e,t)=>e.map((e=>t[e])).sort(g))),F=D.createSelector([r],(e=>Object.keys(e).map((t=>e[t])).sort(g))),I={},h=D.createSelector([y,s,f,p],((e,t,r,o)=>(i,a)=>{const n=a?`${a} - ${i.id}`:i.id,s=e[i.id],c=t[i.id],l=!!s&&s.isDeleted,d=!!s&&2!==c&&4!==c,u=r[i.id]?r[i.id].message:void 0,y=I[n];return y&&y.isDeleted===l&&y.isFavorited===d&&y.data===i&&y.errorMessage===u&&y.iconProps===o||(I[n]={key:n,isDeleted:l,isFavorited:d,groupKey:a,data:i,errorMessage:u,iconProps:o}),I[n]}));function E(e,t,r,o=!0,i=!0,a=!1){return D.createSelector([r,c,m],((r,n,s)=>({alwaysVisible:a,groupKey:e,groupHeader:o?`${t} ${s.toLocaleLowerCase()}`:t,collapsed:!!n[e],items:r,toggleable:i})))}const T=E($.DirectoryGroupKeys.RecentGroupKey,P.RecentGroupHeading,R,!1,!1),_=E($.DirectoryGroupKeys.FavoriteGroupKey,P.FavoriteGroupHeading,t,!0,!0,!0),w=E($.DirectoryGroupKeys.MineGroupKey,P.MemberGroupHeading,A),N=E($.DirectoryGroupKeys.AllGroupKey,P.AllGroupHeading,F,!0,!0,!0),G=D.createSelector([T,_,w,N,d,h],((e,t,r,o,i,a)=>{const n=[];return[e,t,r,o].forEach((e=>{if(e.items.length>0||e.alwaysVisible){const t={toggleable:e.toggleable,key:e.groupKey,title:S(e),collapsed:e.collapsed||!1,isGroupRow:!0};if(n.push(t),!e.collapsed)if(e.groupKey===$.DirectoryGroupKeys.AllGroupKey&&i){const t={key:`${e.groupKey} - LOADING`,groupKey:e.groupKey,isLoadingRow:!0};n.push(t)}else if(0===e.items.length){const t={key:`${e.groupKey} - EMPTY`,groupKey:e.groupKey,isZeroDataRow:!0};n.push(t)}else e.items.forEach((t=>n.push(a(t,e.groupKey))))}})),n})),x=D.createSelector([C.getCurrentFilterState,F,h,u],((e,t,r,o)=>o?t.filter((t=>function(e,t){let r=!0;const o=e[$.DirectoryFilterKeys.KEYWORD_FILTER_KEY],i=e[$.DirectoryFilterKeys.TEAM_FILTER_KEY],a=o?o.value:void 0,n=i?i.value.map((e=>e.key)):void 0;if(r&&n&&n.length){let e=!1;if(t.owners)for(const r of t.owners){const t=r.id;if(n.find((e=>e===t))){e=!0;break}}r=e}r&&a&&(r=(0,v.caseInsensitiveContains)(t.name,a));return r}(e,t))).map((e=>r(e))):[]));return{getDirectoryRows:(e,t)=>l(e)?[]:(0,C.isFilterActive)(e)?x(e,t):G(e,t)}},t[e].getAllOwners=D.createSelector([r],(e=>{const t={};for(const r in e){const o=e[r];for(const e of o.owners)t[e.id]=e}const r=[];for(const e in t)r.push(t[e]);return r.sort(g),r}))}("ReduxDirectorySelectors"),function(e){function*r(){const e=yield S.effects.getContext("directoryContext"),t=yield S.effects.getContext("pageContext"),r=yield S.effects.call([t,t.getService],"IVssContributionService"),o=yield S.effects.call([r,r.getData],e.myDataProviderId),i=n(o);if(i){const{message:r,exceptionInfo:o}=i;yield S.effects.put(Z.DirectoryActions.initialDataLoadFailed(o)),yield S.effects.call(A.traceError,t,e.hubName,"Directory",r)}else yield S.effects.put(Z.DirectoryActions.initialDataLoaded(o)),o.memberKeys&&0!==o.memberKeys.length||o.favorites&&0!==o.favorites.length||(yield S.effects.put(Z.DirectoryActions.rowGroupToggled($.DirectoryGroupKeys.AllGroupKey,!1)))}function*o(){try{const e=d((yield S.effects.getContext("directoryContext")).hubName),t=yield S.effects.call([localStorage,localStorage.getItem],e);if(t){const e=JSON.parse(t);yield S.effects.put(Z.DirectoryActions.rowGroupCollapsedInitialized(e))}}catch(e){}}function*i(e){const{rowGroupKey:t,collapsed:r}=e.payload;t!==$.DirectoryGroupKeys.AllGroupKey||r||(yield S.effects.call(a));try{const e=yield S.effects.getContext("directoryContext"),t=yield S.effects.select(J.getGroupCollapsedMap),r=JSON.stringify(t),o=d(e.hubName);yield S.effects.call([localStorage,localStorage.setItem],o,r)}catch(e){}}function*a(){const e=yield S.effects.select(J.isAllSectionLoading),t=yield S.effects.select(J.isAllSectionPopulated);if(!e&&!t){yield S.effects.put(Z.DirectoryActions.beginLoadAllData());const e=yield S.effects.getContext("directoryContext"),t=yield S.effects.getContext("pageContext"),r=yield S.effects.call([t,t.getService],"IVssContributionService"),o=yield S.effects.call([r,r.getDataAsync],e.allDataProviderId),i=n(o);if(i){const{message:r,exceptionInfo:o}=i;yield S.effects.put(Z.DirectoryActions.loadAllDataFailed(o)),yield S.effects.call(A.traceError,t,e.hubName,"Directory",r)}else yield S.effects.put(Z.DirectoryActions.loadAllDataSucceeded(o))}}function n(e){return e?e.exceptionInfo?{message:`The data provider contained exception info: ${JSON.stringify(e.exceptionInfo)}`,exceptionInfo:e.exceptionInfo}:e.artifacts?void 0:{message:"The data provider returned invalid data. Teams is null",exceptionInfo:{exceptionMessage:"The server returned an invalid response"}}:{message:"The data provider didn't return any data",exceptionInfo:{exceptionMessage:"Server returned no response"}}}function*s(e){const{artifactId:t,artifactName:r,favoriteType:o,favoriteId:i}=e.payload,a=yield S.effects.select((0,J.getFavoriteStatus)(t));3!==a&&4!==a&&(a&&2!==a?i&&(yield S.effects.call(l,t,i,o)):yield S.effects.call(c,t,r,o))}function*c(e,t,r){yield S.effects.put(z.FavoriteActions.beginAddFavorite(e));const o=yield S.effects.getContext("directoryContext"),i=yield S.effects.getContext("pageContext");try{const o=yield S.effects.call([i,i.getRestClient],"IFavoriteRestClient"),a=yield S.effects.select(R.currentProject),n={artifactId:e,artifactProperties:{},artifactName:t,artifactType:r,artifactScope:{id:a.id,type:$.DirectoryConstants.ARTIFACT_SCOPE_TYPE,name:a.name}},s=yield S.effects.call([o,o.createFavorite],n);yield S.effects.put(z.FavoriteActions.addFavoriteSuccessful({id:s.id,artifactId:s.artifactId,artifactName:s.artifactName,artifactType:s.artifactType,artifactProperties:s.artifactProperties,isDeleted:s.artifactIsDeleted}))}catch(t){yield S.effects.put(z.FavoriteActions.addFavoriteFailed(e,t)),yield S.effects.call(A.traceException,i,o.hubName,"Directory",t)}}function*l(e,t,r){yield S.effects.put(z.FavoriteActions.beginRemoveFavorite(e));const o=yield S.effects.getContext("pageContext"),i=yield S.effects.getContext("directoryContext");try{const i=yield S.effects.call([o,o.getRestClient],"IFavoriteRestClient"),a=yield S.effects.select(R.currentProject);yield S.effects.call([i,i.deleteFavoriteById],t,r,$.DirectoryConstants.ARTIFACT_SCOPE_TYPE,a.id),yield S.effects.put(z.FavoriteActions.removeFavoriteSuccessful(e))}catch(t){yield S.effects.put(z.FavoriteActions.removeFavoriteFailed(e,t)),yield S.effects.call(A.traceException,o,i.hubName,"Directory",t)}}function d(e){return`${e}_${$.DirectoryConstants.LOCAL_STORAGE_KEY_PREFIX}`}q=t[e]={},t[e].directorySaga=function*(){yield S.effects.takeEvery("Directory/RowGroupToggled",i),yield S.effects.takeEvery("HubViewState/FilterStateChanged",a),yield S.effects.takeEvery("Directory/ToggleFavorite",s),yield S.effects.call(o),yield S.effects.call(r)},t[e].loadInitialDataFromDataProvider=r,t[e].loadSavedRowGroupCollapsedMapping=o,t[e].groupToggled=i,t[e].loadAllDataFromDataProvider=a,t[e].toggleFavorite=s,t[e].createFavorite=c,t[e].deleteFavorite=l}("ReduxDirectorySaga"),function(e){function r(){return{favorites:{},favoriteStatuses:{},favoriteErrors:{}}}X=t[e]={},t[e].favoritesReducer=function(e,t){return e=e||{favorites:{},favoriteStatuses:{},favoriteErrors:{}},(0,g.default)(e,(e=>{switch(t.type){case"Directory/InitialDataLoaded":{const{favorites:r,favoriteStatuses:o}=function(e){const t={},r={};if(e&&e.length>0)for(const o of e)t[o.artifactId]=o,r[o.artifactId]=1;return{favorites:t,favoriteStatuses:r}}(t.payload.favorites);e.favorites=r,e.favoriteStatuses=o;break}case"Directory/BeginAddFavorite":{const r=t.payload;delete e.favoriteErrors[r],e.favorites[r]={artifactId:r,artifactName:"",artifactType:"",id:"",isDeleted:!1,artifactProperties:{}},e.favoriteStatuses[r]=3;break}case"Directory/AddFavoriteSuccessful":{const r=t.payload;e.favoriteStatuses[r.artifactId]=1,e.favorites[r.artifactId]=r;break}case"Directory/AddFavoriteFailed":{const{artifactId:r,error:o}=t.payload;e.favoriteStatuses[r]=2,e.favoriteErrors[r]=o,delete e.favorites[r];break}case"Directory/BeginRemoveFavorite":{const r=t.payload;delete e.favoriteErrors[r],e.favoriteStatuses[r]=4;break}case"Directory/RemoveFavoriteSuccessful":{const r=t.payload;delete e.favorites[r],e.favoriteStatuses[r]=2;break}case"Directory/RemoveFavoriteFailed":{const{artifactId:r,error:o}=t.payload;e.favoriteStatuses[r]=1,e.favoriteErrors[r]=o;break}}}))},t[e].getDefaultState=r}("ReduxFavoritesFavoritesReducer"),function(e){function r(){return{isFilterBarVisible:!1,isAllSectionLoading:!1,isAllSectionPopulated:!1,rowGroupCollapsedMap:{[$.DirectoryGroupKeys.AllGroupKey]:!0}}}Q=t[e]={},t[e].directoryUIStateReducer=function(e,t){return(0,g.default)(e||r(),(e=>{switch(t.type){case"Directory/InitialDataLoadFailed":e.exceptionInfo=t.payload;break;case"Directory/BeginLoadAllData":e.isAllSectionLoading=!0;break;case"Directory/LoadAllDataSucceeded":e.isAllSectionLoading=!1,e.isAllSectionPopulated=!0;break;case"Directory/LoadAllDataFailed":e.isAllSectionLoading=!1,e.exceptionInfo=t.payload;break;case"Directory/RowGroupCollapsedInitialized":{const r=Object.assign({},t.payload);delete r[$.DirectoryGroupKeys.AllGroupKey],e.rowGroupCollapsedMap=Object.assign(Object.assign({},e.rowGroupCollapsedMap),r);break}case"Directory/RowGroupToggled":{const{collapsed:r,rowGroupKey:o}=t.payload;e.rowGroupCollapsedMap[o]=r;break}case"Directory/ToggleFilter":e.isFilterBarVisible=!e.isFilterBarVisible}}))},t[e].getDefaultState=r}("ReduxUIStateDirectoryUIStateReducer"),function(e){ee=t[e]={},t[e].DirectoryModule={id:"directory",reducerMap:{directoryState:(0,F.combineReducers)({directoryArtifactState:W.artifactReducer,favoriteState:X.favoritesReducer,uiState:Q.directoryUIStateReducer})},sagas:[q.directorySaga]}}("ReduxDirectoryModule"),function(e){t[e]={},t[e].getDirectoryProviderProps=function(e,t,r,o,i){return i=i||[],{initialState:{directoryState:{directoryArtifactState:(0,W.getDefaultState)(),favoriteState:(0,X.getDefaultState)(),uiState:(0,Q.getDefaultState)()},hubViewState:{currentFilterState:{},currentPivot:"",currentViewOptions:{fullScreen:!0}}},sagaContext:{directoryContext:e,pageContext:r},scenarioName:o,hubViewState:t,ttiSplitTimingName:"directoryContent",modules:[(0,I.getTfsPageDataModule)(),ee.DirectoryModule,...i]}}}("ReduxgetDirectoryProviderProps"),function(e){te=t[e]={};class r extends i.Component{constructor(){super(...arguments),this._getListItem=e=>e,this._getOwners=()=>this.props.owners?this.props.owners.map((e=>({key:e.id,name:e.name}))):[],this._setFilterBar=e=>{this._filterBar=e}}componentDidMount(){this.focus()}render(){const{filter:e}=this.props;return i.createElement(T.FilterBar,{className:this.props.className,filter:e,componentRef:this._setFilterBar},i.createElement(_.KeywordFilterBarItem,{filter:e,filterItemKey:$.DirectoryFilterKeys.KEYWORD_FILTER_KEY,placeholder:P.KeywordFilterPlaceholder}),i.createElement(w.PickListFilterBarItem,{filter:e,filterItemKey:$.DirectoryFilterKeys.TEAM_FILTER_KEY,selectionMode:h.SelectionMode.multiple,getPickListItems:this._getOwners,getListItem:this._getListItem,showSelectAll:!1,isSearchable:!0,placeholder:P.TeamFilterPlaceholder}))}focus(){this._filterBar&&this._filterBar.focus()}}t[e].DirectoryFilterBar=r,t[e].ConnectedDirectoryFilterBar=(0,E.connect)((function(e,t){return Object.assign(Object.assign({},t),{owners:(0,J.getAllOwners)(e)})}),null)(r)}("ComponentsDirectoryFilterBarDirectoryFilterBar"),function(e){t[e]={};class r extends i.Component{constructor(){super(...arguments),this._renderFilterBar=()=>{const{hubViewState:{filter:e},onRenderFilterBar:t}=this.props;return t?t(e):i.createElement(te.ConnectedDirectoryFilterBar,{filter:e})},this._onFavoriteToggled=e=>{const{favorites:t,toggleFavorite:r}=this.props,o=e.data.id,i=t[o]?t[o].id:void 0;r(o,e.data.name,e.data.favoriteType,i)},this._onFilterToggled=()=>{const{toggleFilter:e}=this.props;e()},this._onRenderZeroDataRow=e=>{if(e===$.DirectoryGroupKeys.FavoriteGroupKey)return i.createElement(K.FormatComponent,{format:P.FavoritesEmptyText},i.createElement(s.VssIcon,{iconName:"FavoriteStarFill",className:"vss-FavoriteItem--starIcon"}),this.props.artifactName?this.props.artifactName.toLowerCase():P.DefaultArtifactName)},this._onItemClicked=e=>{const t=e.data.url;this.props.navigateToUrl(t)}}render(){const{artifactName:e,onRenderMessageArea:t,isFilterActive:r,isFilterVisible:o,isNavigating:a,commandBarItems:n,viewItems:s}=this.props;return a?i.createElement("div",{className:"absolute-fill flex-column flex-center justify-center"},i.createElement(d.Spinner,{size:"large",label:P.LoadingMessage})):i.createElement(M.Page,{className:"directory-page v-scroll-auto absolute-fill"},t&&t(),i.createElement(O.Header,{title:e,titleSize:1,commandBarItems:[{id:"filter",iconProps:{iconName:r?"FilterSolid":"Filter"},ariaLabel:P.FilterAriaLabel,onActivate:this._onFilterToggled,subtle:!0},...s||[],...n||[]]}),o&&this._renderFilterBar(),this._renderContent())}componentDidMount(){this.props.markTti(this.props.ttiScenarioProps.areaName,this.props.ttiScenarioProps.featureName)}_renderContent(){const{exceptionInfo:e,isAllSectionLoading:t,isFilterActive:r,directoryRows:o}=this.props;return e?this._renderExceptionInfo():r&&t?this._renderFullLoading():r&&0===o.length?this._renderEmptyFilter():this._renderDirectoryGrid()}_renderExceptionInfo(){return i.createElement(G.HubError,{className:"page-content-top",exceptionsInfo:[this.props.exceptionInfo]})}_renderFullLoading(){return i.createElement(d.Spinner,{className:"page-content-top",label:P.LoadingMessage,size:"large"})}_renderEmptyFilter(){return i.createElement(N.AssetResolver,{assets:["ms.vss-work-web/agile-assets/Content/no-results-found.svg"]},(([e])=>i.createElement(L.ZeroData,{className:"page-content-top",imagePath:e,imageAltText:"",primaryText:P.NoResultsFound})))}_renderDirectoryGrid(){const{currentProject:e,customColumns:t,directoryRows:r,isFilterActive:o,onRenderCell:a,toggleGroup:n}=this.props;let s;return s=t?[...t]:[H.DEFAULT_NAME_COLUMN,H.DEFAULT_TEAM_COLUMN],i.createElement("div",{className:"directory-content page-content page-content-top v-scroll-auto"},i.createElement(H.DirectoryGrid,{project:e,rows:r,columns:s,isGrouped:!o,onFavoriteToggled:this._onFavoriteToggled,onGroupToggled:n,onItemClicked:this._onItemClicked,onRenderCell:a,onRenderZeroDataRow:this._onRenderZeroDataRow}))}}function o(){const e=(0,J.createInstanceSelectors)();return(t,r)=>({currentProject:(0,I.currentProject)(t),directoryRows:e.getDirectoryRows(t,r),favorites:(0,J.getFavoriteMap)(t),isFilterActive:(0,C.isFilterActive)(t),isFilterVisible:(0,J.isFilterVisible)(t),isAllSectionLoading:(0,J.isAllSectionLoading)(t),isNavigating:(0,x.isNavigating)(t),exceptionInfo:(0,J.getExceptionInfo)(t)})}t[e].DirectoryContentView=r,t[e].mapStateToProps=o,t[e].Actions={markTti:b.TTIMonitorActions.markTTI,navigateToUrl:x.NavigationActions.fpsNavigateToUrl,toggleFavorite:z.FavoriteActions.toggleFavorite,toggleGroup:Z.DirectoryActions.rowGroupToggled,toggleFilter:Z.DirectoryActions.toggleFilter},t[e].ConnectedDirectoryContentView=(0,E.connect)(o,t[e].Actions)(r)}("ComponentsDirectoryContentView")}),["Resources","Components/DirectoryGrid/DirectoryGridConstants","DirectoryContracts","Components/DirectoryGrid/NameCell","Components/DirectoryGrid/GroupRow","Components/DirectoryGrid/LoadingRow","Components/DirectoryGrid/TeamCell","Components/DirectoryGrid/DirectoryGrid","Components/DirectoryGrid/index","DirectoryConstants","Redux/DirectoryActions","Redux/Favorites/FavoriteActions","Redux/Artifacts/ArtifactReducer","Redux/DirectorySelectors","Redux/DirectorySaga","Redux/Favorites/FavoritesReducer","Redux/UIState/DirectoryUIStateReducer","Redux/DirectoryModule","Redux/getDirectoryProviderProps","Components/DirectoryFilterBar/DirectoryFilterBar","Components/DirectoryContentView"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.agile-directory-bundle"}}));