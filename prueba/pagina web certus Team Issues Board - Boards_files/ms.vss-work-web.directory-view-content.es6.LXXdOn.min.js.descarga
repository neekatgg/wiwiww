"use strict";define("Wit/DirectoryView",["require","exports","Favorites/Star/FavoritesStar","react","Tfs/Platform/TfsComponent","VSS/Core/Observable","VSS/Core/Util/String","VSS/Platform/Layout","VSSUI/List","VSSUI/ListBox","VSSUI/Table","VSSUI/Utilities/GroupedItemProvider","Wit/DirectoryService/IDirectoryService","TFS/TeamProfilePanelIconButton/TeamProfilePanelIconButton","VSSUI/Dropdown","VSSUI/Icon","VSSUI/Observer","VSSUI/Utilities/DropdownSelection","VSSUI/FilterBar","VSSUI/TextFilterBarItem","VSS/Platform/FPS","VSS/Platform/Location","VSSUI/Card","VSSUI/ConditionalChildren","VSSUI/Header","VSSUI/HeaderCommandBar","VSSUI/Page","VSSUI/Panel","VSSUI/Spinner","VSSUI/Surface","VSSUI/TreeEx","VSSUI/ZeroData"],(function(e,t,r,o,i,a,n,s,l,c,d,m,p,h,u,v,y,f,S,I,b,g,w,T,D,F,x,C,N,P,E,V){var L,B,U,A;L=t[A="Resources"]={},t[A].AllTeamsLabel="All team {0}",t[A].FavoriteTeamsLabel="My favorite {0}",t[A].FilterByText="Filter by text",t[A].NameLabel="Name",t[A].NoResultsFound="No results founds",t[A].RecentItemsLabel="Continue where you left off",t[A].RemoveFromFavorites="Remove from favorites",t[A].SearchTeamsPlaceholder="Search team {0}",t[A].ShowFilter="Show filter",t[A].ShowTeamProfile="Show team profile",t[A].MyTeamItemsLabel="My team {0}",t[A].TeamLabel="Team",t[A].ViewDirectoryLabel="View {0} directory",t[A].ZeroDataPrimaryText="No results matched your filter criteria",t[A].ZeroDataSecondaryText="No results were found that matched the specified criteria.",function(e){B=t[e]={};class a extends i.TfsComponent{constructor(e,t){super(e,t),this.favoritesService=t.pageContext.getService("IFavoritesService")}render(){var e,t;if(!this.favoritesService.canUseFavorites())return null;const i={artifactId:this.props.item.id,artifactName:this.props.item.name,artifactType:this.props.artifactType,artifactScope:{id:null===(e=this.projectData)||void 0===e?void 0:e.id,name:null===(t=this.projectData)||void 0===t?void 0:t.name,type:"Project"}};return o.createElement(r.FavoritesStar,{artifact:i,buttonClassName:this.props.buttonClassName,className:this.props.className,onAddFavorite:e=>this.toggleFavorite(e,this.props.onAddFavorite),onRemoveFavorite:e=>this.toggleFavorite(e,this.props.onRemoveFavorite)})}toggleFavorite(e,t){null==e||e.preventDefault(),t&&t()}}t[e].DirectoryFavoriteButton=a}("ComponentsDirectoryFavoriteButton"),function(e){t[e]={};class r extends m.GroupedItemProvider{constructor(e){super([],[],!0),this.loading=new a.ObservableValue(!0),this.getListBoxItemFromDirectoryDropdownItem=e=>({id:e.id,data:e,groupId:this.showGroups?e.group:void 0,text:e.text,iconProps:Object.assign({},this.iconProps),render:this.renderDirectoryDropdownItem}),this.renderDirectoryDropdownItem=(e,t,r,i)=>{var a;const n=null===(a=i.data)||void 0===a?void 0:a.directory;return o.createElement(d.SimpleTableCell,{className:(0,s.css)(r.className,i.className,2===i.type&&"bolt-list-box-header"),columnIndex:t,key:t,tableColumn:r},(0,l.renderListCell)(Object.assign(Object.assign({},i),{textClassName:"flex-grow directory-dropdown-link"}),!0),this.showFavorites&&(null==n?void 0:n.id)&&this.favoriteType&&o.createElement(B.DirectoryFavoriteButton,{artifactType:this.favoriteType,item:n,className:"flex-end bolt-table-cell-content-reveal directory-favorite-cell"}))},this.showActions=!e.hideActions,this.showFavorites=!e.hideFavorites,this.showGroups=!e.hideGroups,this.directoryService=e.directoryService,this.artifactTypeName=e.artifactTypeName,this.favoriteType=e.favoriteType,this.iconProps=e.iconProps,this.directoryHref=e.directoryHref;const t={id:"loading",type:4,render:(e,t,r,i)=>o.createElement(c.LoadingCell,{key:e,columnIndex:t,tableColumn:r,tableItem:i})};this.push(t)}isLoading(){return this.loading}async loadData(){if(!this.dataLoadPromise){this.dataLoadPromise=this.directoryService.getDirectoryDropdownData();const e=await this.dataLoadPromise;if(this.removeAll(),this.showGroups){const e=[{id:p.GroupIds.Favorites,name:(0,n.format)(L.FavoriteTeamsLabel,this.artifactTypeName)},{id:p.GroupIds.Team,name:(0,n.format)(L.MyTeamItemsLabel,this.artifactTypeName)},{id:p.GroupIds.All,name:(0,n.format)(L.AllTeamsLabel,this.artifactTypeName)}];this.pushGroups(...e)}const t=e.map(this.getListBoxItemFromDirectoryDropdownItem);this.push(...t),this.loading.value=!1}}getActions(){return this.actions||(this.actions=new a.ObservableArray,this.showActions&&this.directoryHref&&this.actions.push({text:(0,n.format)(L.ViewDirectoryLabel,this.artifactTypeName),href:this.directoryHref,className:"directory-dropdown-action"})),this.actions}}t[e].DirectoryDropdownProvider=r}("DirectoryDropdownProvider"),function(e){t[e]={};class r extends s.VssComponent{constructor(e,t){super(e,t),this.dropdown=o.createRef(),this.hasMadeInitialSelection=!1,this.makeInitialSelection=()=>{var e,t;const{itemProvider:r}=this.props;if(r.value.length>0&&this.props.selectedItem)for(let o=0;o<r.value.length;o++)if(r.value[o].data&&(null===(t=null===(e=r.value[o].data)||void 0===e?void 0:e.directory)||void 0===t?void 0:t.id)===this.props.selectedItem.id)return this.dropdownSelection.select(o),void(this.hasMadeInitialSelection=!0)},this.onItemsUpdated=()=>(this.hasMadeInitialSelection||this.makeInitialSelection(),!1),this.dropdownSelection=new f.DropdownSelection}render(){const{itemProvider:e}=this.props;return o.createElement(y.UncheckedObserver,{itemProvider:{observableValue:e,filter:this.onItemsUpdated},selection:this.dropdownSelection,isLoading:e.isLoading},(t=>{const r={horizontal:"start",vertical:"end"},i={horizontal:"start",vertical:"start"},{selectedItem:a,onSelect:s,hideFavorites:l,hideIcon:c,calloutWidth:d}=this.props;return o.createElement(u.Dropdown,{actions:e.getActions(),ref:this.dropdown,onSelect:s,className:"directory-selector-dropdown",calloutContentClassName:"directory-dropdown-content",filterThrottleWait:100,selection:this.dropdownSelection,items:e,loading:t.isLoading,onExpand:()=>e.loadData(),renderExpandable:t=>o.createElement(y.Observer,{selection:this.dropdownSelection},(({selection:r})=>{var i,n;const s=r.length>0&&(null===(n=null===(i=e.value[r[0].beginIndex])||void 0===i?void 0:i.data)||void 0===n?void 0:n.directory),d=s||a;return o.createElement("div",{className:"directory-dropdown-expandable-button-container flex-row"},o.createElement(u.DropdownExpandableButton,Object.assign({},t,{subtle:!0}),!c&&o.createElement(v.Icon,Object.assign({className:"icon-large-margin"},e.iconProps)),!s&&a&&a.name),!l&&d&&e.favoriteType&&o.createElement("span",{className:"title-l flex-row"},o.createElement(B.DirectoryFavoriteButton,{artifactType:e.favoriteType,item:d}),o.createElement(h.TeamProfilePanelIconButton,{teamId:d.id,teamName:d.name})))})),renderCallout:t=>o.createElement(u.DropdownCallout,Object.assign({},t,{containerClassName:"directory-selector-callout",anchorOrigin:r,dropdownOrigin:i,filterPlaceholderText:(0,n.format)(L.SearchTeamsPlaceholder,e.artifactTypeName),filteredNoResultsText:L.NoResultsFound})),width:d||480})}))}}t[e].DirectoryDropdown=r}("ComponentsDirectoryDropdown"),function(e){var r;U=t[e]={},function(e){e.Text="text",e.Team="team"}(r=t[e].DirectoryFilterKeys||(t[e].DirectoryFilterKeys={})),t[e].DirectoryFilterBar=function({directoryService:e}){const t=e.getDirectoryFilter();return o.createElement(S.FilterBar,{filter:t},o.createElement(I.KeywordFilterBarItem,{filterItemKey:r.Text,placeholder:L.FilterByText}),o.createElement(u.DropdownFilterBarItem,{filterItemKey:r.Team,filter:t,hideClearAction:!0,items:e.getTeamsItemProvider(),placeholder:L.TeamLabel,selection:new f.DropdownMultiSelection,showPlaceholderAsLabel:!1}))}}("ComponentsDirectoryFilterBar"),function(e){t[e]={};const r={[p.GroupIds.All]:L.AllTeamsLabel,[p.GroupIds.Favorites]:L.FavoriteTeamsLabel,[p.GroupIds.Recent]:L.RecentItemsLabel,[p.GroupIds.Team]:L.MyTeamItemsLabel};class i extends s.VssComponent{constructor(){super(...arguments),this.filterVisible=new a.ObservableValue(!1),this.onActivate=(e,t)=>{const r=t.data.underlyingItem.data;if(null==r?void 0:r.directoryItem.url){const t=this.context.pageContext;(0,b.onClickFPS)(t,r.directoryItem.url,!0,e)}else r.isFolder&&this.props.directoryService.toggleTreeItem(t.data)},this.renderNameCell=(e,t,i,a)=>{const s=`name-${e}-${t}`,l=a.underlyingItem.data,c=l.directoryItem;if(!l.isFolder)return o.createElement(E.ExpandableTreeCell,{contentClassName:"bolt-tree-cell-content-with-button",columnIndex:t,key:s,treeItem:a},o.createElement(v.Icon,{className:"icon-margin",iconName:this.props.rowIconName}),`${c.name} ${this.props.directoryItemName}`,o.createElement("div",{className:"flex-grow"}),o.createElement(B.DirectoryFavoriteButton,{artifactType:this.props.artifactType,className:"bolt-table-cell-content-reveal directory-favorite-cell",item:c,onAddFavorite:()=>this.props.directoryService.addFavorite(c.id),onRemoveFavorite:()=>this.props.directoryService.removeFavorite(c.id)}));const d=r[c.id],m=d?(0,n.format)(d,this.props.directoryItemName):"";return o.createElement(E.ExpandableTreeCell,{contentClassName:"font-weight-semibold",columnIndex:t,key:s,treeColumn:i,treeItem:a},m)},this.renderTeamCell=(e,t,r,i)=>{const a=i.underlyingItem.data,n=a.directoryItem;return o.createElement(d.SimpleTableCell,{ariaRowIndex:e,contentClassName:"bolt-table-cell-content-with-button",columnIndex:t,key:`team-${e}-${t}`},!a.isFolder&&o.createElement(o.Fragment,null,o.createElement("div",{className:"margin-right-4"},o.createElement(h.TeamProfilePanelIconButton,{renderLoadingPanel:e=>o.createElement(C.Panel,{onDismiss:e,size:1},o.createElement("div",{className:"flex-column flex-center flex-grow justify-center"},o.createElement(N.Spinner,{size:"large"}))),teamId:n.id,teamName:n.name})),n.name))},this.commandBarItems=()=>{const e=this.props.directoryService.isFiltering.value,t=(0,F.getFilterItem)((()=>{this.filterVisible.value=!this.filterVisible.value}),e,!0,L.ShowFilter);return this.props.additionalHeaderItem?[t,this.props.additionalHeaderItem]:[t]},this.onSize=(e,t,r,o)=>{o.width.value=r},this.defaultColumns=[{id:"name",name:L.NameLabel,width:new a.ObservableValue(-100),renderCell:this.renderNameCell,onSize:this.onSize},{id:"team",name:L.TeamLabel,width:new a.ObservableValue(-70),renderCell:this.renderTeamCell,onSize:this.onSize}]}render(){const{additionalColumns:e,directoryService:t,pageTitle:r,treeAriaLabel:i,zeroDataContributionId:a}=this.props;return o.createElement(P.Surface,{background:1},o.createElement(x.Page,{className:"backlogs-page flex-grow flex-column"},o.createElement(y.Observer,{isFiltering:t.isFiltering},(()=>o.createElement(D.Header,{title:r,titleSize:1,commandBarItems:this.commandBarItems()}))),o.createElement("div",{className:"page-content page-content-top rhythm-vertical-16"},o.createElement(T.ConditionalChildren,{renderChildren:this.filterVisible},o.createElement(U.DirectoryFilterBar,{directoryService:t})),o.createElement(y.Observer,{treeItems:t.getDirectoryTreeItemProvider()},(r=>{const n=r.treeItems.length>0?"flex-grow bolt-table-card bolt-backlogs-card":"flex-center";return o.createElement(w.Card,{className:n,contentProps:{contentPadding:!1}},r.treeItems.length>0?o.createElement(E.Tree,{ariaLabel:i,columns:e?[...this.defaultColumns,...e]:this.defaultColumns,itemProvider:t.getDirectoryTreeItemProvider(),onActivate:this.onActivate,onToggle:(e,r)=>{t.toggleTreeItem(r)},scrollable:!1}):o.createElement(V.ZeroData,{imagePath:(0,g.getAssetLocation)(this.context.pageContext,a),imageAltText:L.ZeroDataPrimaryText,primaryText:L.ZeroDataPrimaryText,secondaryText:L.ZeroDataSecondaryText}))})))))}}t[e].DirectoryView=i}("ComponentsDirectoryView")}),["Resources","Components/DirectoryFavoriteButton","DirectoryDropdownProvider","Components/DirectoryDropdown","Components/DirectoryFilterBar","Components/DirectoryView"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.directory-view-content"}}));