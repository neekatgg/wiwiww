"use strict";define("Comments/Reactions",["require","exports","react","VSS/Platform/Layout","VSSUI/Button","VSSUI/Callout","VSSUI/Util","VSS/Core/Util/String","VSSUI/FocusZone"],(function(e,t,n,o,a,r,s,i,c){var l,u,d,m,p;l=t[p="Resources"]={},t[p].AddYourReaction="Add your reaction",t[p].ReactionAdditionalUsersCount="+{0} users",t[p].ReactionUserListHeaderPlural="Users with {0} reaction",t[p].ReactionUserListHeaderSingular="User with {0} reaction",t[p].RemoveReaction="Remove your {0} reaction",t[p].AddReaction="Add {0} reaction",t[p].MoreThan99="99+",t[p].ThumbsUp="+1",t[p].ThumbsDown="-1",t[p].PartyPopper="Hooray",t[p].RedHeart="Heart",t[p].SmilingFace="Laugh",t[p].ConfoundedFace="Upset",function(e){u=t[e]={},t[e].ReactionTypeToEmojiMap={0:{encodedValue:"&#x1F44D;",description:l.ThumbsUp},1:{encodedValue:"&#x1F44E;",description:l.ThumbsDown},3:{encodedValue:"&#x1F389;",description:l.PartyPopper},2:{encodedValue:"&#x2764;",description:l.RedHeart},4:{encodedValue:"&#x1F603;",description:l.SmilingFace},5:{encodedValue:"&#x1F616;",description:l.ConfoundedFace}}}("Constants"),function(e){d=t[e]={};class i extends n.PureComponent{constructor(){super(...arguments),this._onRenderReactionDropdown=(e,t,o,i,c,l,d)=>{const{commentId:m,onAddReaction:p,onDeleteReaction:R,reactionTypeToInfoMap:S}=this.props,h=Object.keys(u.ReactionTypeToEmojiMap).map(((t,o,r)=>{const i=Number(t),c=u.ReactionTypeToEmojiMap[i],l=S[i];return n.createElement(a.Button,{key:t,className:"reaction-button-item",onClick:()=>{e.collapse(),l&&l.isCurrentUserEngaged?R(m,i):p(m,i)},onMouseDown:(0,s.isSafari)()?e=>{e.preventDefault()}:void 0,tooltipProps:{text:c.description},excludeTabStop:o>0,role:"menuitem",ariaPosInSet:o+1,ariaSetSize:r.length,ariaLabel:c.description},n.createElement("span",{dangerouslySetInnerHTML:{__html:c.encodedValue}}))})),g=()=>{e.collapse()};return h.length>0?n.createElement(r.Callout,{anchorElement:o,anchorOffset:i,anchorOrigin:c,anchorPoint:l,calloutOrigin:d,onDismiss:g,className:"reaction-selection-container",role:"menu",focuszoneProps:{direction:1,focusOnMount:!0,circularNavigation:!0,preprocessKeyStroke:this._preprocessKeyStroke},blurDismiss:!0,contentShadow:!0,escDismiss:!0},h):n.createElement(n.Fragment,null)},this._preprocessKeyStroke=e=>(e.defaultPrevented||9!==e.which||e.preventDefault(),1)}render(){const{readonly:e,className:t,onAddReactionButtonClick:r,onSelectionDismiss:s,onFocus:i,onBlur:c,excludeTabStop:u,ariaPosInSet:d,ariaSetSize:m}=this.props;return e?n.createElement(n.Fragment,null):n.createElement(a.ExpandableButton,{className:(0,o.css)("comment-reaction-button",t),iconProps:{iconName:"AddReaction"},tooltipProps:{text:l.AddYourReaction},onExpand:r,onCollapse:s,onFocus:i,onBlur:c,renderCallout:this._onRenderReactionDropdown,excludeTabStop:u,role:"menuitem",ariaPosInSet:d,ariaSetSize:m,ariaLabel:l.AddYourReaction,hideDropdownIcon:!0,subtle:!0})}}t[e].CommentReactionSelector=i,o.VssComponent.register("comment-reaction-selector",i)}("ComponentsCommentReactionSelector"),function(e){m=t[e]={};class r extends n.PureComponent{constructor(){super(...arguments),this._onAddReactionFromSelector=(e,t)=>{this.props.onAddReaction(e,t,!1)},this._onDeleteReactionFromSelector=(e,t)=>{this.props.onDeleteReaction(e,t,!1)}}render(){const{commentId:e,readonly:t,reactionTypeToInfoMap:a,onAddReactionButtonClick:s}=this.props,i=this._getButtons();if(i.length>0){const l=i.length+(t?0:1);return n.createElement("div",null,n.createElement(c.FocusZone,{direction:1},n.createElement("div",{className:"reaction-status-container",role:"menubar"},i,n.createElement(d.CommentReactionSelector,{className:(0,o.css)(r.ReactionStatusButton,"reaction-status-new-selector-btn"),readonly:t,commentId:e,onAddReactionButtonClick:s,onAddReaction:this._onAddReactionFromSelector,onDeleteReaction:this._onDeleteReactionFromSelector,reactionTypeToInfoMap:a,ariaPosInSet:l,ariaSetSize:l,excludeTabStop:!0}))))}return n.createElement(n.Fragment,null)}_getButtons(){const{readonly:e,reactionTypeToInfoMap:t}=this.props,s=[],c=Object.keys(t).map((e=>Number(e))).filter((e=>{const n=t[e];return!!n&&n.totalCount>0})),d=c.length+(e?0:1);let m=1;for(const p of c){const{totalCount:c,isCurrentUserEngaged:R}=t[p],S=u.ReactionTypeToEmojiMap[p],h=c>99?l.MoreThan99:c.toString();s.push(n.createElement(a.Button,{key:p,className:(0,o.css)(r.ReactionStatusButton,e&&"reaction-status-button-readonly",R&&"reaction-status-user-engaged"),tooltipProps:e?void 0:this._getTooltip(p,c,S),ariaLabel:i.format(R?l.RemoveReaction:l.AddReaction,S.description),onClick:e?void 0:this._onReactionClick.bind(this,p,R),excludeTabStop:s.length>0,role:"menuitem",ariaPosInSet:m++,ariaSetSize:d},n.createElement("span",{className:"reaction-status-info-container"},n.createElement("span",{dangerouslySetInnerHTML:{__html:S.encodedValue}}),n.createElement("span",null,h))))}return s}_onReactionClick(e,t){const{commentId:n,onAddReaction:o,onDeleteReaction:a}=this.props;t?a(n,e,!0):o(n,e,!0)}_getTooltip(e,t,n){return{renderContent:this._onRenderButtonTooltipContent.bind(this,e,t,n),showOnFocus:!0}}_onRenderButtonTooltipContent(e,t,o){const{commentId:a,onGetRecentlyReactedUsers:r,reactionTypeToInfoMap:s}=this.props,c=Object.keys(s||{}).reduce(((e,t)=>{const n=parseInt(t);return e[n]=s[n].engagedUsers.map((e=>e.identityDisplayName)),e}),{}),u=c[e];let d=[];if(u&&u.length>0){d=u.slice(0,t).map(((e,t)=>n.createElement("li",{key:t},e)));const e=t-10;e>0&&d.push(n.createElement("li",{className:"userlist-item",key:"nmoreusers"},i.format(l.ReactionAdditionalUsersCount,e)))}else r(a,e,100);return d.length>0?n.createElement("div",{className:"userlist-tooltip"},n.createElement("h3",null,i.format(d.length>1?l.ReactionUserListHeaderPlural:l.ReactionUserListHeaderSingular,o.description)),n.createElement("ul",{className:"user-list"},d)):n.createElement(n.Fragment,null)}}t[e].CommentReactionStatusBar=r,r.ReactionStatusButton="reaction-status-button",o.VssComponent.register("comment-reaction-statusbar",r)}("ComponentsCommentReactionStatusBar"),function(e){t[e]={},__exportStar(d,t[e]),__exportStar(m,t[e])}("Reactions"),function(e){function n(e){const t=Object.keys(u.ReactionTypeToEmojiMap).reduce(((e,t)=>(e[Number(t)]={totalCount:0,isCurrentUserEngaged:!1,engagedUsers:[]},e)),{});return(e||[]).forEach((e=>{if(e){const n={totalCount:e.count,isCurrentUserEngaged:e.isCurrentUserEngaged,engagedUsers:[]};t[e.type]=n}})),t}t[e]={},t[e].createReactionsMap=function(e){return n(e)},t[e].reactionsToReactionMap=n}("Util")}),["Resources","Constants","Components/CommentReactionSelector","Components/CommentReactionStatusBar","Reactions","Util"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-comments.reactions"}}));