"use strict";define("Wit/Identity",["require","exports","VSS/Core/Util/String","VSS/Platform/Identity","VSS/Platform/Location"],(function(e,t,i,n,r){var I,E,s;I=t[s="ConstantsConstants"]={},(E=t[s].SubjectType||(t[s].SubjectType={})).AadUser="aad",E.AadGroup="aadgp",E.AadServicePrincipal="aadsp",t.InterfacesWorkItemInterfaces={},function(e){t[e]={};let E={},s={},a={};function d(n){var r;if(!n)return"";var I="",E=n.lastIndexOf(t[e].IDENTITY_UNIQUENAME_SEPARATOR);if(r=-1===E?n:n.substr(0,E),i.startsWith(r,t[e].TFS_GROUP_PREFIX)){var s=r.substr(3).trim();I=i.isGuid(s)?s:""}return I}function N(n){if(!n)return null;var r=n.lastIndexOf(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START),I=n.lastIndexOf(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END),E=!1,s=!1,a=!1,N=n;r>=0&&I>r&&(a=!0,N=N.replace(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START).replace(t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END)),r=N.lastIndexOf(t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START),I=N.lastIndexOf(t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END);var T=N,o="",R="";let _="";var A,D="";if(r>=0&&I>r)if(T=N.substr(0,r).trim(),a){0===(D=N.substr(r+1,I-r-1).trim()).indexOf(t[e].AAD_IDENTITY_USER_PREFIX)?D=D.substr(t[e].AAD_IDENTITY_USER_PREFIX.length):0===D.indexOf(t[e].AAD_IDENTITY_GROUP_PREFIX)&&(E=!0,D=D.substr(t[e].AAD_IDENTITY_GROUP_PREFIX.length));var c=D.lastIndexOf("\\");c>0&&(-1!==(R=D.substr(c+1).trim()).indexOf("@")?(o=R,D=D.substr(0,c).trim()):(T=n,D="",a=!1,E=!1))}else{var u=d(R=N.substr(r+1,I-r-1).trim());_=(A=R)?0!=A.indexOf(t[e].DESCRIPTOR_PREFIX)?"":A.replace(/desc:/i,""):"",-1!==R.indexOf("@")||-1!==R.indexOf("\\")||-1!==R.indexOf(t[e].DESCRIPTOR_PREFIX)||u||i.isGuid(R)?(o=R,""!=u&&(D=u,E=!0,s=!0,o="")):T=n}return{id:D,displayName:T,uniqueName:_||o,isAadIdentity:a,isContainer:E,isTfsGroup:s}}function T(e,t,i){const n=o(t),r=R(t);if(i&&!n&&!r)return _(e,t);if(n){const e=t;return i?e.identityRef:e.distinctDisplayName||e.identityRef.displayName}if(r){return i?t:t.displayName}return t}function o(e){if(e&&void 0!==e.identityRef){const t=e;return t.distinctDisplayName&&!E[t.distinctDisplayName]&&(E[t.distinctDisplayName]=t),t.identityRef&&t.identityRef.descriptor&&!s[t.identityRef.descriptor]&&(s[t.identityRef.descriptor]=t),!0}return!1}function R(e){return!(!e||void 0===e.displayName)}function _(e,t,i){if(E[t])return E[t].identityRef;const n=N(t),r=e.getService("IVssIdentityService");return i=i||r.getIdentityImageUrl(n?n.id:""),n&&n.isAadIdentity?{displayName:t}:n&&{displayName:n.displayName,uniqueName:n.uniqueName,imageUrl:i,_links:{avatar:{href:i}}}}function A(e){let t=Object.assign({},e);return e.identityRef.displayName&&(t.identityRef.displayName=N(t.identityRef.displayName).displayName),t}function D(n,r){return n&&r?i.format("{0} {1}{2}{3}",n,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,r,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):""}function c(n,r){return n&&r?i.format("{0} {1}{2}{3}{4}",n,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].TFS_GROUP_PREFIX,r,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):""}function u(n){if(!n)return"";const r=n.signInAddress||n.samAccountName||n.mail||n.originId;if(E=n,i.equals(E.originDirectory,"aad",!0)&&E.originId&&!E.localId){const r=i.equals(n.entityType,"Group",!0),I=r?t[e].AAD_IDENTITY_GROUP_PREFIX:t[e].AAD_IDENTITY_USER_PREFIX;return!n.signInAddress&&!n.mail||r?i.format("{0} {1}{2}{3}{4}",n.displayName,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,I,n.originId,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):i.format("{0} {1}{2}{3}\\{4}{5}",n.displayName,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,I,n.originId,n.signInAddress||n.mail,t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END)}return function(e){const t=e.displayName.indexOf("\\");return i.equals(e.entityType,"Group",!0)&&i.startsWith(e.displayName,"[")&&-1!==t&&i.endsWith(e.displayName.substring(0,t),"]")}(n)?n.localId?i.format("{0} {1}{2}{3}{4}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].TFS_GROUP_PREFIX,n.localId.toUpperCase(),t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):n.displayName:r?-1===r.indexOf("@")&&n.scopeName&&!function(e){return e.subjectDescriptor.startsWith(I.SubjectType.AadServicePrincipal)}(n)?i.format("{0} {1}{2}\\{3}{4}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,n.scopeName,r,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):i.format("{0} {1}{2}{3}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,r,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):n.subjectDescriptor?i.format("{0} {1}{2}{3}{4}",n.displayName,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START,t[e].DESCRIPTOR_PREFIX,n.subjectDescriptor,t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END):n.displayName||"";var E}function m(e,t){const i=e.getService("IVssIdentityService").getIdentityImageUrl(t);return{displayName:t.displayName,entityId:t.id,entityType:"User",image:i}}t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START="<",t[e].IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END=">",t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_START="<<",t[e].AAD_IDENTITY_UNIQUEFIEDNAME_SEPERATOR_END=">>",t[e].TFS_GROUP_PREFIX="id:",t[e].AAD_IDENTITY_USER_PREFIX="user:",t[e].AAD_IDENTITY_GROUP_PREFIX="group:",t[e].IDENTITY_UNIQUENAME_SEPARATOR="\\",t[e].DESCRIPTOR_PREFIX="desc:",t[e].getVsIdFromGroupUniqueName=d,t[e].parseUniquefiedIdentityName=N,t[e].setResolvedByDescriptorIfWorkItemIdentityRef=function(e){o(e)&&e.identityRef&&e.identityRef.descriptor&&(a[e.identityRef.descriptor]=!0)},t[e].convertPotentialIdentityRefFromFieldValue=T,t[e].convertPotentialIdentityRefFromFieldValueNotAsIdentityRef=function(e){return o(e)?e.distinctDisplayName||e.identityRef.displayName:R(e)?e.displayName:e},t[e].isWorkItemIdentityRef=o,t[e].isIdentityRef=R,t[e].createIdentityRefFromDistinctDisplayName=_,t[e].convertWorkItemIdentityRefFromFieldValue=function(e,t){if(o(t))return A(t);let i=T(e,t,!0);return i||(i={displayName:t}),A({distinctDisplayName:t,identityRef:i})},t[e].uniqueSortWorkItemIdentityRefObjects=function(e){if(!e||0===e.length)return e;const t={};return e.forEach((e=>t[e.distinctDisplayName]=e)),Object.keys(t).sort(i.localeIgnoreCaseComparer).map((e=>t[e]))},t[e].getFriendlyDistinctDisplayName=function(e){return e.displayName&&e.uniqueName&&!e.isTfsGroup?e.isContainer?c(e.displayName,e.id):D(e.displayName,e.uniqueName):e.displayName||""},t[e].getDistinctDisplayName=D,t[e].getDistinctGroupDisplayName=c,t[e].getUniquefiedIdentityName=u,t[e].convertIIdentityToWorkItemIdentityRef=function(e,t,i){const n=u(t);return{distinctDisplayName:n,identityRef:_(e,n,i)}},t[e].convertWorkItemIdentityRefToIIdentity=function(e,t){const i=null==t?void 0:t.identityRef;if(i)return m(e,i)},t[e].convertIdentityRefToIIdentity=m,t[e].getIIdentityObject=function(e,t){if(!t)return;const I="@me";if(0===(0,i.localeIgnoreCaseComparer)(t,I))return{displayName:I,entityId:I,entityType:"User",originDirectory:"",originId:"",image:(0,r.getAssetLocation)(e,"ms.vss-work-web/common-content/Content/memacro-user.svg")};const E=t.substring(0,t.indexOf("<")).trim(),s=-1!==t.indexOf("<id:");let a;return a=s?t.substring(t.indexOf(":")+1,t.length-1).trim():t.substring(t.indexOf("<")+1,t.length-1).trim(),{displayName:E,entityId:"",entityType:s?"Group":"User",localId:s?a:"",mail:s?"":a,originId:s?a:"",samAccountName:s?"":a,signInAddress:s?"":a,image:(0,n.getIdentityImageUrl)(e,_(e,t))}};const l=/.*\<[0-9\-\@a-f]+\>$/i;t[e].stripIdPartFromDisplayName=function(e){return l.test(e)?e.substr(0,e.lastIndexOf("<")).trim():e}}("UtilitiesWorkItemIdentityHelper")}),["Constants/Constants","Interfaces/WorkItemInterfaces","Utilities/WorkItemIdentityHelper"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.identity-content"}}));