"use strict";define("Dashboards/WidgetCatalog",["require","exports","VSS/Platform/Util/Url","VSS/Ext/ExternalContentUtil","VSS/Platform/Feature"],(function(t,o,n,e,i){var r,s;r=o[s="Resources"]={},o[s].WidgetContributionIdMissing="Widget Contribution Id was not provided",o[s].WidgetContributionCouldNotLoad="Widget Contribution could not be loaded, for Widget Type Id: {0}",o[s].WidgetComponentContributionIdMissing="Component Contribution Id was not provided",o[s].WidgetComponentContributionCouldNotLoad="Component Contribution could not be loaded",o[s].MicrosoftContributionPublisherName="Microsoft",function(t){o[t]={};o[t].WidgetCatalogQuery=class{constructor(t){this.projectId=t}getKey(){return"WidgetCatalogQuery."+(null!=this.projectId?this.projectId.toLowerCase():"Unscoped")}runQuery(t){return function(t,o){const n=t.getRestClient("IDashboardRestClient");return n.getWidgetTypes(1,o).then((t=>({catalogEntries:t.widgetTypes.map((t=>{const o=t.allowedSizes&&0!==t.allowedSizes.length?t.allowedSizes.slice().sort(((t,o)=>t.columnSpan-o.columnSpan||t.rowSpan-o.rowSpan)):[{columnSpan:1,rowSpan:1}];return{canStoreCrossProjectSettings:!0,catalogIconUrl:t.catalogIconUrl,catalogInfoURI:i(t.catalogInfoUrl)?t.catalogInfoUrl:"",configContributionId:t.configurationContributionId,contributionId:t.contributionId,defaultSize:t.allowedSizes&&t.allowedSizes.length>0?t.allowedSizes[0]:o[0],description:t.description,isNameConfigurable:t.isNameConfigurable,isVisibleFromCatalog:t.isVisibleFromCatalog,keywords:t.keywords,lightbox:t.lightboxOptions,name:t.name,publisherName:"ms"===t.publisherName?r.MicrosoftContributionPublisherName:t.publisherName,supportedSizes:o,tags:t.tags}})),galleryUrl:t._links&&t._links.web&&t._links.web.href})))}(t,this.projectId)}};const e=["http","https"];function i(t){try{const o=new n.Uri(t).scheme;return e.indexOf(o)>=0}catch(t){return!1}}}("WidgetCatalogQuery"),function(t){function n(t,o){if(!o)throw new Error(r.WidgetContributionIdMissing);let n=t.getService("IVssContributionService").getContribution(o);if(n)return n=s(t,o,n),n;throw new Error(r.WidgetContributionCouldNotLoad)}function s(t,o,n){return"ms.vss-dashboards-web.Microsoft.VisualStudioOnline.Dashboards.SprintBurndownWidget"===o&&((0,i.isFeatureEnabled)(t,"ms.vss-dashboards-web.sprint-burndown-availability")?n.lightbox={width:900,height:700,resizable:!0}:(n.supportedSizes=[{rowSpan:1,columnSpan:2}],n.configComponentContributionId=void 0)),n}o[t]={},o[t].resolveWidgetContributionAsync=async function(t,o){if(!o)throw new Error(r.WidgetContributionIdMissing);const n=t.getService("IVssContributionService");let e=await n.getContributionAsync(o);if(e)return e=s(t,o,e),e;throw new Error(r.WidgetContributionCouldNotLoad)},o[t].resolveComponentContributionAsync=async function(t,o){if(!o)throw new Error(r.WidgetComponentContributionIdMissing);const n=t.getService("IVssContributionService"),e=await n.getContributionAsync(o);return e&&e.componentType&&e.includes?await{componentType:e.componentType,includes:e.includes}:null},o[t].getProviderInfo=function(t,o){const n="UnknownContributionProvider",i=t.getService("IVssContributionService").getContributionProvider(o)||{id:"Unknown",displayName:n};return(0,e.getExtensionMarketplaceUrl)(t,i.id).then((t=>({providerDisplayName:null!=i?i.displayName:n,marketplaceUrl:t})))},o[t].isInternalContribution=function(t){return t.startsWith("ms.vss")},o[t].contributionHasModernImplementation=function(t,o){let e;try{e=n(t,o)}catch(t){e=null}return null!=e&&null!=e.widgetComponentContributionId&&!e.ignoreComponentContributionForDashboardLoad},o[t].resolveWidgetContribution=n,o[t].widgetImplementationIsSlow=function(t,o){return((0,i.isFeatureFlagEnabled)(o,"WebAccess.Dashboards.DelayLoadSlowWidgets.Enable",!1)?["ms.vss-dashboards-web.Microsoft.VisualStudioOnline.Dashboards.VelocityWidget"]:[]).some((o=>t===o))}}("WidgetContributionsHelper")}),["Resources","WidgetCatalogQuery","WidgetContributionsHelper"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-dashboards.dashboards-widget-catalog"}}));