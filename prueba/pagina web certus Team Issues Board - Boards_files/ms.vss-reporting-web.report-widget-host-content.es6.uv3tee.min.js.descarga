"use strict";define("Reporting/ReportWidgetHost",["require","exports","Dashboards/Common/RestClient/Dashboard","VSS/Core/Util/String","VSS/Platform/Trace","Dashboards/WidgetHost/WidgetHost","react","VSS/Platform/Layout","VSSUI/Spinner"],(function(e,t,i,o,s,n,r,a,d){var g,c,p;g=t[p="Resources"]={},t[p].WidgetCopySucceeded="Widget {0} copied to {1}",function(e){function n(e){return{contributionId:e.sourceWidget.contributionId,name:e.sourceWidget.name,size:e.sourceWidget.size,settings:e.sourceWidget.settings,settingsVersion:e.sourceWidget.settingsVersion}}c=t[e]={},t[e].copyWidget=async function(e,t){try{const s=n(t),r=function(e){const t=e.getService("ITfsPageService"),i=t.getData();if(!i||!i.project)throw new Error("Couldn't fetch project information.");return i.project}(e),a={teamId:t.destinationDashboard.groupId||"",projectId:r.id},d=(0,i.getDashboardClient)(e),c=await d.createWidget(s,a,t.destinationDashboard.id);if(null!=c&&c.id!=s.id){e.getService("IGlobalMessagesService").addToast({duration:3e3,message:(0,o.format)(g.WidgetCopySucceeded,t.sourceWidget.name,t.destinationDashboard.name)})}}catch(t){(0,s.traceException)(e,"ReportingWidgetHost","copyWidget()",t),console.log(t)}},t[e].packWidget=n}("CopyWidget"),function(e){t[e]={};class i extends a.VssComponent{render(){return r.createElement("div",{className:"report-widget-host-container flex-column"},r.createElement(o,Object.assign({},this.props)))}}t[e].ReportWidgetHostContainer=i;class o extends a.VssComponent{constructor(e){super(e),this.onCopyWidget=e=>{(0,c.copyWidget)(this.context.pageContext,e)},this.onWidgetLoaded=()=>{this.setState({isLoading:!1})},this.getWidgetPixelSize=()=>this.props.renderSize,this.state={isLoading:!0,iterationKey:0}}componentWillReceiveProps(e){e.settings===this.props.settings&&e.lastRefreshDate===this.props.lastRefreshDate||this.setState({isLoading:!0,iterationKey:this.state.iterationKey+1})}render(){const e=this.assembleWidgetProps(this.props),t=this.props.allowPinning;return r.createElement(r.Fragment,null,this.state.isLoading&&r.createElement("div",{style:this.props.renderSize},r.createElement(d.Spinner,{className:"report-host-spinner"})," "),r.createElement("div",{className:this.state.isLoading?"hidden":""},r.createElement(n.WidgetHost,{key:this.state.iterationKey,widgetHostParentProps:{onWidgetLoaded:this.onWidgetLoaded,onCopyWidget:t?this.onCopyWidget:void 0},convertToPixelSize:this.getWidgetPixelSize,widgetPresentationMode:"embedded-View",parentPageName:this.props.parentPageName,widgetProps:e,shouldNotShowTitle:!0,userCanConfigure:!0,openLinksInNewTab:!0,showLoadAnimations:0===this.state.iterationKey,teamContext:this.props.teamContext})))}assembleWidgetProps(e){return{contributionId:e.contributionId,name:e.name,size:this.props.widgetPinningSize,settings:e.settings,settingsVersion:e.settingsVersion||{major:1,minor:0,patch:0},isEnabled:!0,position:{column:0,row:0},areSettingsBlockedForUser:!1,configurationContributionId:"FAKE - UNUSED",isNameConfigurable:!1}}}t[e].ReportWidgetHost=o}("ReportWidgetHost")}),["Resources","CopyWidget","ReportWidgetHost"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-reporting-web.report-widget-host-content"}}));