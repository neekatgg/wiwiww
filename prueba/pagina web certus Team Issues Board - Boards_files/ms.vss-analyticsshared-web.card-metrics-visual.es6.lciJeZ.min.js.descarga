"use strict";define("Analytics/Shared/Visuals/CardMetricsVisual",["require","exports","Analytics/Shared/Common/AnalyticsDataValidator","Analytics/Shared/Common/Types","Analytics/Shared/Utils/Number","Analytics/Shared/Visuals/Common/Components/AnalyticsUnavailableMessage","react","VSS/Core/Util/String","VSS/Platform/Components/ErrorBoundary","VSS/Platform/Layout","VSSUI/Card","VSSUI/Header","VSSUI/Icon","VSSUI/Link","VSSUI/Spinner","VSSUI/Util","xss","xss/PresetOptions"],(function(e,t,a,r,s,i,n,l,o,c,m,d,p,h,g,f,u,y){var x,C;x=t[C="Resources"]={},t[C].DataNotReady="This typically takes few minutes, but can take longer depending on the amount of data in your organization.</br></br>Please, check back later.",t[C].LearnMore="Learn more",t[C].TrendFormat="{0}%",t[C].ErrorMessage="There was an error",t[C].ViewFullReport="View full report",function(e){var C;t[e]={},function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large",e[e.XLarge=3]="XLarge",e[e.XXLarge=4]="XXLarge",e[e.XXXLarge=5]="XXXLarge"}(C=t[e].MetricSize||(t[e].MetricSize={}));class E extends c.VssComponent{constructor(){super(...arguments),this._onLinkClick=e=>{e.stopPropagation(),this.props.onLinkClick&&this.props.onLinkClick(e)},this._onCardClick=e=>{this.props.onCardClick&&this.props.onCardClick(e)},this._onCardKeyDown=e=>{13!==e.keyCode&&32!==e.keyCode||this.props.onCardClick(e)},this._getMessage=e=>{if(e!==r.ViewType.DataNotReadyView)return""},this._getSuggestion=(e,t)=>e===r.ViewType.DataNotReadyView?x.DataNotReady:e===r.ViewType.ErrorView?t:void 0,this._checkIfMetricDataPresent=()=>null!=this.props.primaryMetric||null!=this.props.secondaryMetric}render(){return n.createElement("div",{className:(0,f.css)("analytics-cardmetrics-area flex-column flex-grow",this.props.className||""),onClick:this._onCardClick,onKeyDown:this._onCardKeyDown,tabIndex:0,role:"region"},n.createElement(o.ErrorBoundary,{handlerComponentType:"tfs.page-error-handler"},n.createElement(m.CustomCard,{className:"flex-grow analytics-card"},n.createElement(d.Header,{className:"analytics-card-header bolt-card-header",title:this.props.title,titleAriaLevel:2,description:this._checkIfMetricDataPresent()&&!this.props.errorText?this.props.subtitle:""}),n.createElement(m.CardContent,{contentPadding:!1},n.createElement(a.AnalyticsDataValidator,{dataValidationPromises:this.props.dataValidationPromises,compactView:!0,getMessage:this._getMessage,getSuggestion:this._getSuggestion},n.createElement("div",{className:"flex-column flex-grow"},this._getElementToDisplay(),this.props.children))),n.createElement(m.CardFooter,{className:"analytics-card-footer"},n.createElement("div",{className:"flex-column flex-grow flex-self-end"},this.props.insight&&this._checkIfMetricDataPresent()&&n.createElement("div",{className:"card-metrics-insight flex-row font-size-m font-weight-normal secondary-text"},n.createElement("div",{className:"flex-self-start"},n.createElement(p.Icon,{className:"card-metric-insight-icon icon-margin font-size-ml",iconName:"CRMCustomerInsightsApp"})),n.createElement("span",{className:"card-metrics-insight-text",dangerouslySetInnerHTML:{__html:(0,u.filterXSS)(this.props.insight,y.xssStyleDefaultOptions)}})),n.createElement("div",{className:"flex-row"},this.props.linkTarget&&n.createElement(h.Link,{className:"flex flex-grow flex-self-end",onClick:this._onLinkClick,target:"_blank",href:this.props.linkTarget},x.LearnMore),!this.props.errorText&&n.createElement("div",{className:"flex flex-grow view-report font-size-m font-weight-semibold"},n.createElement(p.Icon,{className:"icon-margin",iconName:"ChevronRight"}),n.createElement("span",null,x.ViewFullReport))))))))}_getPrimaryMetricElement(e,t){return n.createElement("div",{className:"card-metrics-element flex-row"},n.createElement("div",{className:"card-metrics-value font-size-lll flex-self-end"},e.value,e.suffix&&n.createElement("span",{className:"font-size-ll"},e.suffix)),t&&n.createElement("div",{className:(0,f.css)("pipeline-trend flex-self-end font-weight-semibold",this.props.isTrendGood?"positive-color":"negative-color")},n.createElement(p.Icon,{className:"trend-icon font-size-xs",iconName:t.trendType===r.TrendType.Increased?"TriangleSolidUp12":"TriangleSolidDown12"}),n.createElement("span",{className:"font-size-m"},(0,l.localeFormat)(x.TrendFormat,s.formatAbbreviatedNumber(t.percentageVariation||0)))))}getFontClassName(e){let t="";switch(e){case C.Small:t="fontSizeS";break;case C.Medium:t="font-size-m";break;case C.Large:t="font-size-l";break;case C.XLarge:t="font-size-xl";break;case C.XXLarge:t="font-size-xxl";break;case C.XXXLarge:t="font-size-xxxl"}return t}_getMetricElement(e){let t="font-size-m",a="body-xl";const r=this.props.secondaryMetricSize;return r&&(void 0!==r.label&&(t=this.getFontClassName(r.label)),void 0!==r.value&&(a=this.getFontClassName(r.value))),n.createElement("div",{className:"card-metrics-element flex-column"},n.createElement("div",{className:`card-metrics-label ${t} secondary-text`},e.label),n.createElement("div",{className:`card-metrics-value ${a} font-weight-semibold`},e.value),e.footer&&n.createElement("div",{className:"font-size-m secondary-text"},e.footer))}_getElementToDisplay(){return this.props.errorText?n.createElement(i.AnalyticsUnavailableMessage,{message:x.ErrorMessage,suggestion:this.props.errorText,iconName:this.props.iconName,messageClassName:"ax-unavailable-error-message"}):this.props.info?n.createElement(i.AnalyticsUnavailableMessage,{info:this.props.info,iconName:this.props.iconName}):this._checkIfMetricDataPresent()?n.createElement(n.Fragment,null,n.createElement("div",{className:"flex-row flex-wrap bolt-default-horizontal-spacing"},this.props.primaryMetric&&this._getPrimaryMetricElement(this.props.primaryMetric,this.props.trend),this.props.secondaryMetric&&this._getMetricElement(this.props.secondaryMetric))):n.createElement(g.Spinner,{className:"card-spinner flex-column flex-grow",size:"large"})}}t[e].CardMetricsVisual=E}("CardMetricsVisual")}),["Resources","CardMetricsVisual"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-analyticsshared-web.card-metrics-visual"}}));