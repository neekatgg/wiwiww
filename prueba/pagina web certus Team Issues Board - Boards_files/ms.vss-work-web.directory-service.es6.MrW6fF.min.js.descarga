"use strict";define("Wit/DirectoryService",["require","exports","VSS/Core/Observable","VSS/Platform/Context","VSSUI/Utilities/Filter","VSSUI/Utilities/TreeItemProvider"],(function(t,e,r,i,a,o){!function(t){var s;e[t]={},function(t){t.All="all",t.Favorites="favorites",t.Team="team",t.Recent="recent"}(s=e[t].GroupIds||(e[t].GroupIds={}));class l extends i.VssService{constructor(){super(...arguments),this.allDirectoryData=[],this.continueDirectoryData=[],this.favoritesDirectoryData=[],this.filter=new a.Filter,this.placeholderRowCount=5,this.filteredAllDirectoryData=new r.ObservableArray(new Array(this.placeholderRowCount).fill(void 0)),this.isFilteredObservable=new r.ObservableValue(!1),this.initialDirectories={},this.teamDirectoryData=[],this._serviceStart=t=>{super._serviceStart(t),this.filteredAllDirectoryData.subscribe(this.updateTreeItemProviderItems),this.filter.subscribe(this.filterAllDirectoryData),this.filter.subscribe(this.updateIsFiltering)},this._serviceEnd=t=>{super._serviceEnd(t),this.filteredAllDirectoryData.unsubscribe(this.updateTreeItemProviderItems),this.filter.unsubscribe(this.filterAllDirectoryData),this.filter.unsubscribe(this.updateIsFiltering)},this.getDirectoryDropdownData=()=>(this.getDirectoryDropdownDataPromise||(this.getDirectoryDropdownDataPromise=Promise.all([this.loadAllDirectoryData(),this.loadDirectoryData()]).then((()=>{const t={},e=[],r=(r,i)=>{t[r.id]||(e.push(function(t,e){return{text:t.name,id:`${t.id}-${e}`,directory:t,group:e,href:t.url}}(r,i)),t[r.id]=!0)};return this.favoritesDirectoryData.forEach((t=>r(t,s.Favorites))),this.teamDirectoryData.forEach((t=>r(t,s.Team))),this.allDirectoryData.forEach((t=>r(t,s.All))),e}))),this.getDirectoryDropdownDataPromise),this.getDirectoryFilter=()=>this.filter,this.getDirectoryTreeItemProvider=()=>(this.treeItemProvider||(this.treeItemProvider=new o.TreeItemProvider([]),this.loadDirectoryData(),this.updateTreeItemProviderItems()),this.treeItemProvider),this.getTeamsItemProvider=()=>{if(!this.teamItemProvider){const t=async()=>{await this.loadAllDirectoryData(),this.teamItemProvider.value=this.allDirectoryData.map((t=>({id:t.id,text:t.name})))};this.teamItemProvider=new r.ObservableArray([]),t()}return this.teamItemProvider},this.toggleTreeItem=t=>{let e=t.underlyingItem;e.id===s.All&&this.loadAllDirectoryData(),this.treeItemProvider.toggle(e)},this.addFavorite=t=>{var e;if(-1===this.favoritesDirectoryData.findIndex((e=>e.id===t))){const r=this.initialDirectories[t]||(null===(e=this.allDirectoryData)||void 0===e?void 0:e.find((e=>e.id===t)));r&&(this.favoritesDirectoryData.push(r),this.favoritesDirectoryData=this.favoritesDirectoryData.sort(c))}},this.removeFavorite=t=>{const e=this.favoritesDirectoryData.findIndex((e=>e.id===t));-1!==e&&this.favoritesDirectoryData.splice(e,1)},this.filterAllDirectoryData=()=>{0===this.allDirectoryData.length&&this.updateTreeItemProviderItems(),this.loadAllDirectoryData().then((()=>{this.filteredAllDirectoryData.value=D(this.allDirectoryData,this.filter.getState())}))},this.updateTreeItemProviderItems=()=>{if(this.treeItemProvider){let t=[];h(this.filter.getState())?t=t.concat(this.flattenDirectoryData(this.filteredAllDirectoryData)):(this.continueDirectoryData.length>0&&(t=t.concat(this.convertDirectoryDataToTreeItems(this.continueDirectoryData,s.Recent))),t=t.concat(this.convertDirectoryDataToTreeItems(this.favoritesDirectoryData,s.Favorites)).concat(this.convertDirectoryDataToTreeItems(this.teamDirectoryData,s.Team)).concat(this.convertDirectoryDataToTreeItems(this.filteredAllDirectoryData.value,s.All))),this.treeItemProvider.splice(void 0,this.treeItemProvider.roots,[{items:t}])}},this.convertDirectoryDataToTreeItem=t=>({data:t?{directoryItem:Object.assign({},t),isFolder:!1,linkProps:{href:t.url}}:void 0}),this.flattenDirectoryData=t=>t.value.map(this.convertDirectoryDataToTreeItem),this.convertDirectoryDataToTreeItems=(t,e)=>[{childItems:t.map(this.convertDirectoryDataToTreeItem),data:{directoryItem:{id:e},isFolder:!0},expanded:this.isExpanded(e),id:e}],this.showErrorMessage=t=>{},this.isExpanded=t=>{var e;const r=null===(e=this.treeItemProvider.roots.find((e=>e.id===t)))||void 0===e?void 0:e.expanded;return void 0===r?t!==s.All:r},this.loadDirectoryData=()=>(this.loadDirectoryDataPromise||(this.loadDirectoryDataPromise=new Promise(((t,e)=>this.loadDirectoryDataHelper(t,e)))),this.loadDirectoryDataPromise),this.loadDirectoryDataHelper=(t,e)=>{const r=this.pageContext.getService("IVssContributionService"),i=r.getData(this.myDirectoryDataProviderContribution),a=e=>{e&&e.forEach((t=>{t.isMostRecent&&this.continueDirectoryData.push(t),t.isFavorite&&this.favoritesDirectoryData.push(t),t.isMember&&this.teamDirectoryData.push(t)})),t()};i?a(i):r.getDataAsync(this.myDirectoryDataProviderContribution).catch((t=>{this.showErrorMessage(t),this.loadDirectoryDataPromise=void 0})).then((t=>a(t)))},this.loadAllDirectoryData=()=>{if(!this.loadAllDirectoryDataPromise){const t=this.pageContext.getService("IVssContributionService");this.loadAllDirectoryDataPromise=t.getDataAsync(this.allDirectoryDataProviderContribution).catch((t=>{this.showErrorMessage(t),this.loadAllDirectoryDataPromise=void 0})).then((t=>(t&&(this.allDirectoryData=t,this.filteredAllDirectoryData.value=D(this.allDirectoryData,this.filter.getState())),this.allDirectoryData)))}return this.loadAllDirectoryDataPromise},this.updateIsFiltering=t=>{this.isFilteredObservable.value=h(t)}}get isFiltering(){return this.isFilteredObservable}}function c(t,e){return t.name.localeCompare(e.name)}function D(t=[],e){return h(e)?t.filter((t=>(!e.text||t.name.toLocaleLowerCase().indexOf(e.text.value.toLocaleLowerCase())>=0)&&(!e.team||0===e.team.value.length||e.team.value.includes(t.id)))):t}function h(t){return!!t&&Object.keys(t).some((e=>{var r;const i=null===(r=t[e])||void 0===r?void 0:r.value;return Array.isArray(i)?i.length>0:!!i}))}e[t].DirectoryService=l}("IDirectoryService")}),["IDirectoryService"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.directory-service"}}));