"use strict";define("Wit/WorkItem/Service",["require","exports","react","VSS/Platform/Context","VSS/Platform/FPS","VSS/Platform/Layout","VSS/Platform/Location","Wit/Clients/Wit/RestClient/WorkItemTracking","Wit/Common/Generated/Constants","Wit/Common/BulkUpdateUtils/BulkUpdateInterfaces","Wit/Common/BulkUpdateUtils/BulkUpdateUtils","Wit/WorkItemModel/WorkItem/FieldUtils"],(function(e,t,o,r,a,s,i,n,l,c,m,p){t.index={},function(e){t.WorkItemService={};class d extends r.VssService{createWorkItem(e,t,r,n){if(0===t){const t=this.pageContext.getService("ITfsPageService").getData();if(t&&t.project){let o=`${(0,i.routeUrl)(this.pageContext,"ms.vss-work-web.work-items-create-route",{project:t.project.name})}/${e}`;if(n&&Object.keys(n).length>0){o=`${o}?${Object.keys(n).map((e=>`[${e}]=${n[e]}`)).join("&")}`}(0,a.FastPageSwitch)(this.pageContext,o,!0)}}else{this.pageContext.getService("IVssLayoutManager").renderCallout((t=>o.createElement(s.WrappedComponent,{wrappedType:"legacy",dependencies:["ms.vss-web.legacy-content"],wrappedProps:{modules:["WorkItemTracking/SharedScripts/WorkItemDialogShim"],wrappedType:"createNewWorkItemDialog",workItemTypeName:e,onDismiss:t,options:r,initialValues:n}})))}}openWorkItemWithProps(e){this.pageContext.getService("IVssLayoutManager").renderCallout((t=>o.createElement(s.WrappedComponent,{wrappedType:"work-item-form-dialog",dependencies:["ms.vss-work-web.work-item-dialogs"],wrappedProps:Object.assign(Object.assign({},e),{onDismiss:()=>{var o;null===(o=e.onDismiss)||void 0===o||o.call(e),t()}})})))}openWorkItem(e,t,r){this.pageContext.getService("IVssLayoutManager").renderCallout((a=>o.createElement(s.WrappedComponent,{wrappedType:"legacy",dependencies:["ms.vss-web.legacy-content"],wrappedProps:{modules:["WorkItemTracking/SharedScripts/WorkItemDialogShim"],wrappedType:"WorkItemDialog",workItemId:e,onDismiss:a,options:t,tryGetLatest:r}})))}getWorkItemUrl(e,t){return(0,i.routeUrl)(this.pageContext,"ms.vss-work-web.work-item-view-route",{id:e.toString(10),project:t})}async loadWorkItem(e,t,o){const r=(await Promise.all(this.loadWorkItems(e,[t],o))).flat();return r.length?r[0]:void 0}loadWorkItems(e,t,o){const r=[];for(var a=0;a<t.length;a+=d.workItemBatchSize)r.push(t.slice(a,a+d.workItemBatchSize));const s=(0,n.getWorkItemTrackingClient)(this.pageContext);return r.map((t=>{const r={errorPolicy:2,ids:t,fields:o};return s.getWorkItemsBatch(r,e)}))}async setWorkItemInitialState(e,t){var o;const r=[],a=new Map;for(const s of e){const e=this.getInitialStateForTargetType(s,t),i=s.getFieldValueByName(l.CoreFieldRefNames.State);e&&i!==e?a.has(e)?null===(o=a.get(e))||void 0===o||o.push(s.id):a.set(e,[s.id]):r.push(s)}for(const e of a){const t=[{fieldName:l.CoreFieldRefNames.State,value:e[0]}],o=new Map;o.set(c.BulkUpdateConstants.AllTypes,t);const a=await(0,m.performBulkUpdate)(this.pageContext,e[1],o);r.push(...a)}return r}getInitialStateForTargetType(e,t){const o=e.getFieldByName(l.CoreFieldRefNames.State),r=(0,p.getAllowedFieldValues)(o,e,t).value;if(r.length>0){return r[0]}}}d.workItemBatchSize=200,r.Services.add("work-item-service",{serviceFactory:d})}()}),["index","WorkItemService"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.work-item-service-content"}}));