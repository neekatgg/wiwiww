"use strict";define("Comments/Item",["require","exports","Comments/Common/Telemetry","Comments/Viewer/Components/CommentViewer","react","VSS/Core/Util/Object","VSS/Platform/Layout"],(function(e,t,o,n,i,s,r){var a,d;!function(e){a=t[e]={};const d="comment-editor";class m extends r.VssComponent{constructor(e,t){super(e,t),this._editButtonRef=i.createRef(),this._renderViewer=()=>{const{readonly:e,canEdit:t,formatDisabled:o,comment:s,baseUrl:r,viewerClassName:a,viewerContentClassName:d,onPostRenderContent:m,compactMode:c,getPermalink:l,isReactionsEnabled:h,onGetRecentlyReactedUsers:p,reactionTypeToInfoMap:u,onRenderPersona:C,onRenderCommentBody:_,tooltipTimeFormat:g,currentDate:f,doNotHighlight:E}=this.props;return i.createElement(n.CommentViewer,{readonly:e,canEdit:t,comment:s,baseUrl:r,formatDisabled:o,editButtonRef:this._editButtonRef,onStartEdit:this._onStartEdit,onConfirmDelete:this._onConfirmDelete,onMoreClick:this._onMoreClick,className:a,contentClassName:d,getPermalink:l,onPostRenderContent:m,onRenderPersona:c?C:void 0,isReactionsEnabled:h,onAddReactionButtonClick:this._onAddReactionButtonClick,onAddReaction:this._onAddReaction,onDeleteReaction:this._onDeleteReaction,onGetRecentlyReactedUsers:p,reactionTypeToInfoMap:u,onRenderCommentBody:_,tooltipTimeFormat:g,currentDate:f,doNotHighlight:E})},this._onAddReactionButtonClick=()=>{this._usageTelemetry.publishClickReactionSelectionButton()},this._onAddReaction=(e,t,o)=>{const{onAddReaction:n}=this.props;n&&n(e,t,o),this._usageTelemetry.publishEngagedReaction(t.toString(),o)},this._onDeleteReaction=(e,t,o)=>{const{onDeleteReaction:n}=this.props;n&&n(e,t,o),this._usageTelemetry.publishDisEngagedReaction(t.toString(),o)},this._onCancelEdit=(e,t)=>{const{onCancelEdit:o}=this.props;o(e,t),this._usageTelemetry.publishEditCommentCancel(t)},this._onStartEdit=e=>{const{onStartEdit:t}=this.props;t(e),this._usageTelemetry.publishEditComment()},this._onConfirmDelete=(e,t)=>{const{onConfirmDelete:o}=this.props;o(e,t)},this._onMoreClick=e=>{const{onMoreClick:t}=this.props;t&&t(e),this._usageTelemetry.publishClickMoreButton()},this._onUpdate=(e,t,o)=>{const{onUpdate:n,comment:i}=this.props;n(e,t,o),this._usageTelemetry.publishEditCommentUpdate(o.length,t.length,i.version)},this._onKeepDraft=(e,t)=>{const{onKeepDraft:o}=this.props;o&&o(e,t),this._usageTelemetry.publishEditCommentKeepDraft()},this.state={isEditorLoaded:!!r.Components.get(d)},this._usageTelemetry=new o.UsageTelemetryHelper(e.artifactInfo,t.pageContext)}render(){const{compactMode:e}=this.props;return e?this._renderCompactMode():this._renderFullMode()}componentDidMount(){this._fetchEditorIfNeeded()}componentDidUpdate(e,t){if(super.componentDidUpdate(e,t),e.isEditing&&!this.props.isEditing){if(function(){const e=window.navigator.userAgent.toLowerCase();return/mozilla.*rv:([\d+.]+)/.test(e)&&e.indexOf("trident")<0}())return void setTimeout((()=>this._resetFocusToEditButton()),200);this._resetFocusToEditButton()}this._fetchEditorIfNeeded()}shouldComponentUpdate(e,t){return!(0,s.shallowCompare)(e,this.props)||!(0,s.shallowCompare)(t,this.state)}_resetFocusToEditButton(){this._editButtonRef.current&&this._editButtonRef.current.focus()}_renderCompactMode(){const{className:e,bodyClassName:t}=this.props;return i.createElement("div",{className:(0,r.css)("comment-item","compact-mode",e,t)},this._renderBody())}_renderFullMode(){const{comment:e,className:t,bodyClassName:o,onRenderPersona:n}=this.props,s=e.createdOnBehalfOf||e.createdBy;return i.createElement("div",{className:(0,r.css)("comment-item flex-row",t)},i.createElement("div",{className:"comment-item-left"},n(s)),i.createElement("div",{className:(0,r.css)("comment-item-right flex-grow",o)},this._renderBody()))}_renderBody(){const{comment:e,editorClassName:t,isEditing:o,onChange:n,onDirtyChange:s,onRenderEditor:a,onEditorMounted:m,onRenderPreview:c,uploadImageHandler:l}=this.props,{isEditorLoaded:h}=this.state;return o&&h?i.createElement(r.WrappedComponent,{wrappedType:d,wrappedProps:{comment:e,onUpdate:this._onUpdate,onCancelEdit:this._onCancelEdit,onRenderEditor:a,onRenderPreview:c,onDirtyChange:s,onEditorMounted:m,onKeepDraft:this._onKeepDraft,onChange:n,uploadImageHandler:l,className:t}}):this._renderViewer()}_fetchEditorIfNeeded(){if(!this.props.isEditing||this.state.isEditorLoaded)return;const e="ms.vss-comments.editor";this.trackPromise(this._getContributionService().getContributionAsync(e).then((()=>this.setState({isEditorLoaded:!0}))).catch((t=>t&&!t.canceled&&this._usageTelemetry.traceError("_fetchEditorIfNeeded",t,{id:e}))))}_getContributionService(){return this._contributionService||(this._contributionService=this.context.pageContext.getService("IVssContributionService")),this._contributionService}}t[e].CommentItem=m,r.VssComponent.register("comment-item",m)}("ComponentsCommentItem"),t[d="CommentItem"]={},Object.defineProperty(t[d],"CommentItem",{enumerable:!0,get:function(){return a.CommentItem}})}),["Components/CommentItem","CommentItem"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-comments.item"}}));