"use strict";define("VC/Stats",["require","exports","react","VSSUI/Icon","VSSUI/Util","VSS/Core/Util/String","VSS/Platform/Layout","VSS/Legacy/Legacy"],(function(e,t,s,a,n,o,r,c){var i,m;i=t[m="Resources"]={},t[m].LanguagesHeaderText="Languages",t[m].ProjectLanguage_ItemNameAriaLabel="{0} Language {1} percent",t[m].ProjectLanguages_AriaLabel="Project Languages",t[m].CommitsAndChangeSets="Commits and Changesets by {0} authors",t[m].ChangeSetsByAuthorsString="Changesets by {0} authors",t[m].CommitsByAuthorsString="Commits by {0} authors",t[m].PullRequestsOpened="Pull requests opened",t[m].MoreThan10K="10K+",function(e){t[e]={};class c extends r.VssComponent{constructor(e,t){super(e,t);const s=t.pageContext.getService("IVssContributionService").getContribution("ms.vss-code-web.code-service-navigation-info");s&&(this._serviceName=s.name),this.state={}}componentDidMount(){super.componentDidMount(),this._fetchCodeMetrics(this.props.numOfDays)}componentDidUpdate(e,t){super.componentDidUpdate(e,t),e.numOfDays!==this.props.numOfDays&&this._fetchCodeMetrics(this.props.numOfDays)}render(){return s.createElement("div",{className:(0,n.css)(this.props.className,"code-metric-tile")},(this.state.gitmetrics||this.state.tfvcmetrics)&&this._serviceName?s.createElement(m,{metricData:this.state,title:this._serviceName}):null)}_fetchCodeMetrics(e){const t=this.context.pageContext.getService("IVssPerformanceService"),s={numOfDays:e};t.startScenario("FetchCodeMetrics",!1),this.trackPromise(this.context.pageContext.getService("IVssContributionService").getDataAsync("ms.vss-code-web.code-metrics-data-provider-verticals",s)).promise.then((e=>{e?(t.endScenario("CodeMetricsSection","FetchCodeMetrics",!1),this.setState(e)):this._endPerfScenario(t)}),(()=>{this._endPerfScenario(t)}))}_endPerfScenario(e){e.endScenario("CodeMetricsSection","FetchCodeMetrics",!1,void 0,{status:"failed"})}}t[e].CodeMetricsSection=c;const m=e=>{const{tfvcmetrics:t,gitmetrics:a}=e.metricData;let n,r=0;if(t&&a){r=t.changesets+a.commitsPushedCount;const e=a.authorsCount+t.authors;n=(0,o.format)(i.CommitsAndChangeSets,e)}else t?(r=t.changesets,n=(0,o.format)(i.ChangeSetsByAuthorsString,t.authors)):a&&(r=a.commitsPushedCount,n=(0,o.format)(i.CommitsByAuthorsString,a.authorsCount));return s.createElement(s.Fragment,null,s.createElement("div",{className:"body-l"},e.title),s.createElement("div",{className:"code-stats flex-row"},a&&d("pull-request-created code-stats-component","BranchMerge",a.pullRequestsCreatedCount,i.PullRequestsOpened),d("commits-and-changesets code-stats-component","BranchCommit",r,n)))},d=(e,t,o,r)=>s.createElement("div",{className:(0,n.css)(e,"flex-row flex-grow")},s.createElement(a.Icon,{iconName:t,className:"code-icon body-l"}),s.createElement("div",{className:"count-and-text"},s.createElement("div",{className:"title-xs"}," ",o>1e4?i.MoreThan10K:o," "),s.createElement("div",{className:"text body-s word-break"},r)));r.Components.add("VC.CodeStats",c)}("CodeMetricsSection"),function(e){t.ProjectLanguagesComponent={};class a extends r.VssComponent{constructor(e,t){super(e,t),this.state={languages:[]}}componentDidMount(){super.componentDidMount(),this._loadLanguages()}render(){const e=(this.state.languages||[]).map((e=>({text:e.name,tooltipText:e.languagePercentage.toString()+" %",tagItemAriaLabel:(0,o.format)(i.ProjectLanguage_ItemNameAriaLabel,e.name,e.languagePercentage.toString()),isFocusable:!0})));return e.length>0?s.createElement("div",{className:"project-languages"},this.props.showHeader&&s.createElement("div",{className:"title font-weight-semibold"},i.LanguagesHeaderText),s.createElement(c.LegacyComponent,{wrappedType:"TFS.ProjectOverview.TagListControl",modules:["ProjectOverview/Scripts/Shared/Components/TagListControl"],tags:e,editMode:!1,listAriaLabel:i.ProjectLanguages_AriaLabel})):null}_loadLanguages(){this.trackPromise(this.context.pageContext.getService("IVssContributionService").getDataAsync(a.PROVIDER_ID)).promise.then((e=>{e&&this.setState({languages:e.projectLanguages.languages})}),(()=>{}))}}a.PROVIDER_ID="ms.vss-code-web.vc-project-languages-data-provider",r.Components.add("VC.ProjectLanguages",a)}()}),["Resources","CodeMetricsSection","ProjectLanguagesComponent"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-code-web.stats-content"}}));